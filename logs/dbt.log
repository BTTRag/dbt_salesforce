2020-05-05 23:21:14.123392 (MainThread): Running with dbt=0.16.0
2020-05-05 23:21:14.262791 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, exclude=None, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/Users/kristin/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', single_threaded=False, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2020-05-05 23:21:14.264059 (MainThread): Tracking: tracking
2020-05-05 23:21:14.271002 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107369190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e5f9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107369b50>]}
2020-05-05 23:21:14.290589 (MainThread): Partial parsing not enabled
2020-05-05 23:21:14.292394 (MainThread): Parsing macros/core.sql
2020-05-05 23:21:14.296574 (MainThread): Parsing macros/materializations/helpers.sql
2020-05-05 23:21:14.303951 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2020-05-05 23:21:14.305548 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2020-05-05 23:21:14.321608 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2020-05-05 23:21:14.353055 (MainThread): Parsing macros/materializations/seed/seed.sql
2020-05-05 23:21:14.372653 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2020-05-05 23:21:14.374441 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2020-05-05 23:21:14.380724 (MainThread): Parsing macros/materializations/common/merge.sql
2020-05-05 23:21:14.393094 (MainThread): Parsing macros/materializations/table/table.sql
2020-05-05 23:21:14.399299 (MainThread): Parsing macros/materializations/view/view.sql
2020-05-05 23:21:14.405393 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2020-05-05 23:21:14.410362 (MainThread): Parsing macros/etc/get_custom_alias.sql
2020-05-05 23:21:14.411282 (MainThread): Parsing macros/etc/query.sql
2020-05-05 23:21:14.412306 (MainThread): Parsing macros/etc/is_incremental.sql
2020-05-05 23:21:14.413854 (MainThread): Parsing macros/etc/get_relation_comment.sql
2020-05-05 23:21:14.415786 (MainThread): Parsing macros/etc/datetime.sql
2020-05-05 23:21:14.424619 (MainThread): Parsing macros/etc/get_custom_schema.sql
2020-05-05 23:21:14.426586 (MainThread): Parsing macros/etc/get_custom_database.sql
2020-05-05 23:21:14.427564 (MainThread): Parsing macros/adapters/common.sql
2020-05-05 23:21:14.467359 (MainThread): Parsing macros/schema_tests/relationships.sql
2020-05-05 23:21:14.468427 (MainThread): Parsing macros/schema_tests/not_null.sql
2020-05-05 23:21:14.469280 (MainThread): Parsing macros/schema_tests/unique.sql
2020-05-05 23:21:14.470298 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2020-05-05 23:21:14.472436 (MainThread): Parsing macros/etc.sql
2020-05-05 23:21:14.473369 (MainThread): Parsing macros/catalog.sql
2020-05-05 23:21:14.479898 (MainThread): Parsing macros/adapters.sql
2020-05-05 23:21:14.500171 (MainThread): Parsing macros/materializations/seed.sql
2020-05-05 23:21:14.502031 (MainThread): Parsing macros/materializations/view.sql
2020-05-05 23:21:14.503463 (MainThread): Parsing macros/materializations/table.sql
2020-05-05 23:21:14.513386 (MainThread): Parsing macros/materializations/incremental.sql
2020-05-05 23:21:14.525503 (MainThread): Parsing macros/materializations/snapshot.sql
2020-05-05 23:21:14.542273 (MainThread): Partial parsing not enabled
2020-05-05 23:21:14.572336 (MainThread): Acquiring new bigquery connection "model.salesforce.salesforce_sales_snapshot".
2020-05-05 23:21:14.572458 (MainThread): Opening a new connection, currently in state init
2020-05-05 23:21:14.586844 (MainThread): Acquiring new bigquery connection "model.salesforce.salesforce_owner_performance".
2020-05-05 23:21:14.586950 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:21:14.592547 (MainThread): Acquiring new bigquery connection "model.salesforce.salesforce_manager_performance".
2020-05-05 23:21:14.592626 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:21:14.599142 (MainThread): Acquiring new bigquery connection "model.salesforce.salesforce_opportunity_enhanced".
2020-05-05 23:21:14.599223 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:21:14.605984 (MainThread): Acquiring new bigquery connection "model.salesforce.opportunity_aggregation_by_owner".
2020-05-05 23:21:14.606067 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:21:14.611849 (MainThread): Acquiring new bigquery connection "model.salesforce.stg_salesforce_opportunity".
2020-05-05 23:21:14.611926 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:21:14.619369 (MainThread): Acquiring new bigquery connection "model.salesforce.stg_salesforce_user".
2020-05-05 23:21:14.619449 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:21:14.623896 (MainThread): Acquiring new bigquery connection "model.salesforce.stg_salesforce_user_role".
2020-05-05 23:21:14.623975 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:21:14.627918 (MainThread): Acquiring new bigquery connection "model.salesforce.stg_salesforce_account".
2020-05-05 23:21:14.627996 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:21:14.664901 (MainThread): Acquiring new bigquery connection "test.salesforce.not_null_stg_salesforce_account_account_id".
2020-05-05 23:21:14.664988 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:21:14.672397 (MainThread): Acquiring new bigquery connection "test.salesforce.unique_stg_salesforce_account_account_id".
2020-05-05 23:21:14.672472 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:21:14.680032 (MainThread): Acquiring new bigquery connection "test.salesforce.not_null_stg_salesforce_opportunity_opportunity_id".
2020-05-05 23:21:14.680111 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:21:14.685977 (MainThread): Acquiring new bigquery connection "test.salesforce.unique_stg_salesforce_opportunity_opportunity_id".
2020-05-05 23:21:14.686052 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:21:14.692675 (MainThread): Acquiring new bigquery connection "test.salesforce.not_null_stg_salesforce_user_user_id".
2020-05-05 23:21:14.692761 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:21:14.699053 (MainThread): Acquiring new bigquery connection "test.salesforce.unique_stg_salesforce_user_user_id".
2020-05-05 23:21:14.699132 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:21:14.705424 (MainThread): Acquiring new bigquery connection "test.salesforce.not_null_stg_salesforce_user_role_user_role_id".
2020-05-05 23:21:14.705506 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:21:14.712121 (MainThread): Acquiring new bigquery connection "test.salesforce.unique_stg_salesforce_user_role_user_role_id".
2020-05-05 23:21:14.712283 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:21:14.940429 (MainThread): Found 9 models, 8 tests, 0 snapshots, 0 analyses, 141 macros, 0 operations, 0 seed files, 0 sources
2020-05-05 23:21:14.947752 (MainThread): 
2020-05-05 23:21:14.948102 (MainThread): Acquiring new bigquery connection "master".
2020-05-05 23:21:14.948273 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:21:14.955320 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_digital-arbor-400".
2020-05-05 23:21:14.955444 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2020-05-05 23:21:15.950928 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_digital-arbor-400_dbt_kristin_test".
2020-05-05 23:21:15.951172 (ThreadPoolExecutor-1_0): Re-using an available connection from the pool (formerly list_digital-arbor-400).
2020-05-05 23:21:15.951416 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2020-05-05 23:21:16.097691 (MainThread): 16:21:16 | Concurrency: 4 threads (target='dev')
2020-05-05 23:21:16.097896 (MainThread): 16:21:16 | 
2020-05-05 23:21:16.100122 (Thread-1): Began running node model.salesforce.stg_salesforce_account
2020-05-05 23:21:16.100366 (Thread-2): Began running node model.salesforce.stg_salesforce_opportunity
2020-05-05 23:21:16.100751 (Thread-1): Acquiring new bigquery connection "model.salesforce.stg_salesforce_account".
2020-05-05 23:21:16.100871 (Thread-3): Began running node model.salesforce.stg_salesforce_user
2020-05-05 23:21:16.101063 (Thread-4): Began running node model.salesforce.stg_salesforce_user_role
2020-05-05 23:21:16.101409 (Thread-2): Acquiring new bigquery connection "model.salesforce.stg_salesforce_opportunity".
2020-05-05 23:21:16.101550 (Thread-1): Re-using an available connection from the pool (formerly list_digital-arbor-400_dbt_kristin_test).
2020-05-05 23:21:16.101926 (Thread-3): Acquiring new bigquery connection "model.salesforce.stg_salesforce_user".
2020-05-05 23:21:16.102276 (Thread-4): Acquiring new bigquery connection "model.salesforce.stg_salesforce_user_role".
2020-05-05 23:21:16.102417 (Thread-2): Opening a new connection, currently in state init
2020-05-05 23:21:16.102543 (Thread-1): Compiling model.salesforce.stg_salesforce_account
2020-05-05 23:21:16.102642 (Thread-3): Opening a new connection, currently in state init
2020-05-05 23:21:16.102733 (Thread-4): Opening a new connection, currently in state init
2020-05-05 23:21:16.102871 (Thread-2): Compiling model.salesforce.stg_salesforce_opportunity
2020-05-05 23:21:16.113952 (Thread-3): Compiling model.salesforce.stg_salesforce_user
2020-05-05 23:21:16.120273 (Thread-4): Compiling model.salesforce.stg_salesforce_user_role
2020-05-05 23:21:16.130829 (Thread-1): finished collecting timing info
2020-05-05 23:21:16.131200 (Thread-2): finished collecting timing info
2020-05-05 23:21:16.136682 (Thread-3): finished collecting timing info
2020-05-05 23:21:16.141932 (Thread-4): finished collecting timing info
2020-05-05 23:21:16.142739 (Thread-2): Compilation Error in model stg_salesforce_opportunity (models/base/stg_salesforce_opportunity.sql)
  Required var 'opportunity' not found in config:
  Vars supplied to stg_salesforce_opportunity = {}
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 223, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 160, in compile_and_execute
    ctx.node = self.compile(manifest)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 335, in compile
    return compile_node(self.adapter, self.config, self.node, manifest, {})
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/compilation.py", line 250, in compile_node
    node = compiler.compile_node(node, manifest, extra_context)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/compilation.py", line 157, in compile_node
    node)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 415, in get_rendered
    return render_template(template, ctx, node)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 409, in render_template
    return template.render(ctx)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/jinja2/environment.py", line 1090, in render
    self.environment.handle_exception()
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/jinja2/environment.py", line 832, in handle_exception
    reraise(*rewrite_traceback_stack(source=source))
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/jinja2/_compat.py", line 28, in reraise
    raise value.with_traceback(tb)
  File "<template>", line 4, in top-level template code
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/context/base.py", line 147, in __call__
    return self.get_missing_var(var_name)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/context/base.py", line 127, in get_missing_var
    raise_compiler_error(msg, self.model)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/exceptions.py", line 363, in raise_compiler_error
    raise CompilationException(msg, node)
dbt.exceptions.CompilationException: Compilation Error in model stg_salesforce_opportunity (models/base/stg_salesforce_opportunity.sql)
  Required var 'opportunity' not found in config:
  Vars supplied to stg_salesforce_opportunity = {}
2020-05-05 23:21:16.142357 (Thread-1): Compilation Error in model stg_salesforce_account (models/base/stg_salesforce_account.sql)
  Required var 'account' not found in config:
  Vars supplied to stg_salesforce_account = {}
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 223, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 160, in compile_and_execute
    ctx.node = self.compile(manifest)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 335, in compile
    return compile_node(self.adapter, self.config, self.node, manifest, {})
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/compilation.py", line 250, in compile_node
    node = compiler.compile_node(node, manifest, extra_context)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/compilation.py", line 157, in compile_node
    node)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 415, in get_rendered
    return render_template(template, ctx, node)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 409, in render_template
    return template.render(ctx)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/jinja2/environment.py", line 1090, in render
    self.environment.handle_exception()
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/jinja2/environment.py", line 832, in handle_exception
    reraise(*rewrite_traceback_stack(source=source))
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/jinja2/_compat.py", line 28, in reraise
    raise value.with_traceback(tb)
  File "<template>", line 4, in top-level template code
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/context/base.py", line 147, in __call__
    return self.get_missing_var(var_name)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/context/base.py", line 127, in get_missing_var
    raise_compiler_error(msg, self.model)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/exceptions.py", line 363, in raise_compiler_error
    raise CompilationException(msg, node)
dbt.exceptions.CompilationException: Compilation Error in model stg_salesforce_account (models/base/stg_salesforce_account.sql)
  Required var 'account' not found in config:
  Vars supplied to stg_salesforce_account = {}
2020-05-05 23:21:16.143344 (Thread-3): Compilation Error in model stg_salesforce_user (models/base/stg_salesforce_user.sql)
  Required var 'user' not found in config:
  Vars supplied to stg_salesforce_user = {}
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 223, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 160, in compile_and_execute
    ctx.node = self.compile(manifest)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 335, in compile
    return compile_node(self.adapter, self.config, self.node, manifest, {})
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/compilation.py", line 250, in compile_node
    node = compiler.compile_node(node, manifest, extra_context)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/compilation.py", line 157, in compile_node
    node)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 415, in get_rendered
    return render_template(template, ctx, node)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 409, in render_template
    return template.render(ctx)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/jinja2/environment.py", line 1090, in render
    self.environment.handle_exception()
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/jinja2/environment.py", line 832, in handle_exception
    reraise(*rewrite_traceback_stack(source=source))
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/jinja2/_compat.py", line 28, in reraise
    raise value.with_traceback(tb)
  File "<template>", line 4, in top-level template code
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/context/base.py", line 147, in __call__
    return self.get_missing_var(var_name)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/context/base.py", line 127, in get_missing_var
    raise_compiler_error(msg, self.model)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/exceptions.py", line 363, in raise_compiler_error
    raise CompilationException(msg, node)
dbt.exceptions.CompilationException: Compilation Error in model stg_salesforce_user (models/base/stg_salesforce_user.sql)
  Required var 'user' not found in config:
  Vars supplied to stg_salesforce_user = {}
2020-05-05 23:21:16.143856 (Thread-4): Compilation Error in model stg_salesforce_user_role (models/base/stg_salesforce_user_role.sql)
  Required var 'user_role' not found in config:
  Vars supplied to stg_salesforce_user_role = {}
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 223, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 160, in compile_and_execute
    ctx.node = self.compile(manifest)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 335, in compile
    return compile_node(self.adapter, self.config, self.node, manifest, {})
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/compilation.py", line 250, in compile_node
    node = compiler.compile_node(node, manifest, extra_context)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/compilation.py", line 157, in compile_node
    node)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 415, in get_rendered
    return render_template(template, ctx, node)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 409, in render_template
    return template.render(ctx)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/jinja2/environment.py", line 1090, in render
    self.environment.handle_exception()
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/jinja2/environment.py", line 832, in handle_exception
    reraise(*rewrite_traceback_stack(source=source))
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/jinja2/_compat.py", line 28, in reraise
    raise value.with_traceback(tb)
  File "<template>", line 4, in top-level template code
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/context/base.py", line 147, in __call__
    return self.get_missing_var(var_name)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/context/base.py", line 127, in get_missing_var
    raise_compiler_error(msg, self.model)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/exceptions.py", line 363, in raise_compiler_error
    raise CompilationException(msg, node)
dbt.exceptions.CompilationException: Compilation Error in model stg_salesforce_user_role (models/base/stg_salesforce_user_role.sql)
  Required var 'user_role' not found in config:
  Vars supplied to stg_salesforce_user_role = {}
2020-05-05 23:21:16.149739 (Thread-2): Finished running node model.salesforce.stg_salesforce_opportunity
2020-05-05 23:21:16.149945 (Thread-1): Finished running node model.salesforce.stg_salesforce_account
2020-05-05 23:21:16.150106 (Thread-3): Finished running node model.salesforce.stg_salesforce_user
2020-05-05 23:21:16.150278 (Thread-4): Finished running node model.salesforce.stg_salesforce_user_role
2020-05-05 23:21:16.151003 (Thread-2): Began running node model.salesforce.salesforce_opportunity_enhanced
2020-05-05 23:21:16.151146 (Thread-2): 16:21:16 | 1 of 4 SKIP relation dbt_kristin_test.salesforce_opportunity_enhanced due to ephemeral model error [ERROR SKIP]
2020-05-05 23:21:16.151253 (Thread-2): Compilation Error in model stg_salesforce_user (models/base/stg_salesforce_user.sql)
2020-05-05 23:21:16.151337 (Thread-2):   Required var 'user' not found in config:
2020-05-05 23:21:16.151416 (Thread-2):   Vars supplied to stg_salesforce_user = {}
2020-05-05 23:21:16.151508 (Thread-2): Finished running node model.salesforce.salesforce_opportunity_enhanced
2020-05-05 23:21:16.151763 (Thread-3): Began running node model.salesforce.opportunity_aggregation_by_owner
2020-05-05 23:21:16.151863 (Thread-4): Began running node model.salesforce.salesforce_sales_snapshot
2020-05-05 23:21:16.151997 (Thread-3): Finished running node model.salesforce.opportunity_aggregation_by_owner
2020-05-05 23:21:16.152116 (Thread-4): 16:21:16 | 2 of 4 SKIP relation dbt_kristin_test.salesforce_sales_snapshot...... [SKIP]
2020-05-05 23:21:16.152383 (Thread-2): Began running node model.salesforce.salesforce_manager_performance
2020-05-05 23:21:16.152495 (Thread-4): Finished running node model.salesforce.salesforce_sales_snapshot
2020-05-05 23:21:16.152583 (Thread-1): Began running node model.salesforce.salesforce_owner_performance
2020-05-05 23:21:16.152718 (Thread-2): 16:21:16 | 3 of 4 SKIP relation dbt_kristin_test.salesforce_manager_performance. [SKIP]
2020-05-05 23:21:16.152921 (Thread-1): 16:21:16 | 4 of 4 SKIP relation dbt_kristin_test.salesforce_owner_performance... [SKIP]
2020-05-05 23:21:16.153097 (Thread-2): Finished running node model.salesforce.salesforce_manager_performance
2020-05-05 23:21:16.153208 (Thread-1): Finished running node model.salesforce.salesforce_owner_performance
2020-05-05 23:21:16.202584 (MainThread): 16:21:16 | 
2020-05-05 23:21:16.202946 (MainThread): 16:21:16 | Finished running 4 table models in 1.25s.
2020-05-05 23:21:16.203223 (MainThread): Connection 'master' was left open.
2020-05-05 23:21:16.203431 (MainThread): Connection 'model.salesforce.stg_salesforce_account' was left open.
2020-05-05 23:21:16.203606 (MainThread): Connection 'model.salesforce.stg_salesforce_opportunity' was properly closed.
2020-05-05 23:21:16.203746 (MainThread): Connection 'model.salesforce.stg_salesforce_user' was properly closed.
2020-05-05 23:21:16.203879 (MainThread): Connection 'model.salesforce.stg_salesforce_user_role' was properly closed.
2020-05-05 23:21:16.215426 (MainThread): 
2020-05-05 23:21:16.215618 (MainThread): Completed with 1 error and 0 warnings:
2020-05-05 23:21:16.215740 (MainThread): 
2020-05-05 23:21:16.215854 (MainThread): Compilation Error in model.salesforce.salesforce_opportunity_enhanced, caused by compilation error in referenced ephemeral model model.salesforce.stg_salesforce_user
2020-05-05 23:21:16.215969 (MainThread): 
Done. PASS=3 WARN=0 ERROR=1 SKIP=0 TOTAL=4
2020-05-05 23:21:16.216159 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107728f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107726590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1077267d0>]}
2020-05-05 23:21:16.216364 (MainThread): Flushing usage events
2020-05-05 23:22:22.774757 (MainThread): Running with dbt=0.16.0
2020-05-05 23:22:22.910273 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, exclude=None, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/Users/kristin/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', single_threaded=False, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2020-05-05 23:22:22.911163 (MainThread): Tracking: tracking
2020-05-05 23:22:22.916646 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110b28110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110b28690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110b28910>]}
2020-05-05 23:22:22.937786 (MainThread): Partial parsing not enabled
2020-05-05 23:22:22.939742 (MainThread): Parsing macros/core.sql
2020-05-05 23:22:22.943953 (MainThread): Parsing macros/materializations/helpers.sql
2020-05-05 23:22:22.952915 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2020-05-05 23:22:22.954736 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2020-05-05 23:22:22.971406 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2020-05-05 23:22:23.001454 (MainThread): Parsing macros/materializations/seed/seed.sql
2020-05-05 23:22:23.020733 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2020-05-05 23:22:23.022468 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2020-05-05 23:22:23.028244 (MainThread): Parsing macros/materializations/common/merge.sql
2020-05-05 23:22:23.039811 (MainThread): Parsing macros/materializations/table/table.sql
2020-05-05 23:22:23.046051 (MainThread): Parsing macros/materializations/view/view.sql
2020-05-05 23:22:23.051818 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2020-05-05 23:22:23.056440 (MainThread): Parsing macros/etc/get_custom_alias.sql
2020-05-05 23:22:23.057323 (MainThread): Parsing macros/etc/query.sql
2020-05-05 23:22:23.058319 (MainThread): Parsing macros/etc/is_incremental.sql
2020-05-05 23:22:23.059856 (MainThread): Parsing macros/etc/get_relation_comment.sql
2020-05-05 23:22:23.061711 (MainThread): Parsing macros/etc/datetime.sql
2020-05-05 23:22:23.069738 (MainThread): Parsing macros/etc/get_custom_schema.sql
2020-05-05 23:22:23.071496 (MainThread): Parsing macros/etc/get_custom_database.sql
2020-05-05 23:22:23.072429 (MainThread): Parsing macros/adapters/common.sql
2020-05-05 23:22:23.109225 (MainThread): Parsing macros/schema_tests/relationships.sql
2020-05-05 23:22:23.110252 (MainThread): Parsing macros/schema_tests/not_null.sql
2020-05-05 23:22:23.111074 (MainThread): Parsing macros/schema_tests/unique.sql
2020-05-05 23:22:23.112044 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2020-05-05 23:22:23.114103 (MainThread): Parsing macros/etc.sql
2020-05-05 23:22:23.114699 (MainThread): Parsing macros/catalog.sql
2020-05-05 23:22:23.120969 (MainThread): Parsing macros/adapters.sql
2020-05-05 23:22:23.139663 (MainThread): Parsing macros/materializations/seed.sql
2020-05-05 23:22:23.141430 (MainThread): Parsing macros/materializations/view.sql
2020-05-05 23:22:23.142719 (MainThread): Parsing macros/materializations/table.sql
2020-05-05 23:22:23.151713 (MainThread): Parsing macros/materializations/incremental.sql
2020-05-05 23:22:23.163072 (MainThread): Parsing macros/materializations/snapshot.sql
2020-05-05 23:22:23.178694 (MainThread): Partial parsing not enabled
2020-05-05 23:22:23.206304 (MainThread): Acquiring new bigquery connection "model.salesforce.salesforce_sales_snapshot".
2020-05-05 23:22:23.206386 (MainThread): Opening a new connection, currently in state init
2020-05-05 23:22:23.219754 (MainThread): Acquiring new bigquery connection "model.salesforce.salesforce_owner_performance".
2020-05-05 23:22:23.219828 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:22:23.225195 (MainThread): Acquiring new bigquery connection "model.salesforce.salesforce_manager_performance".
2020-05-05 23:22:23.225271 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:22:23.234746 (MainThread): Acquiring new bigquery connection "model.salesforce.salesforce_opportunity_enhanced".
2020-05-05 23:22:23.234943 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:22:23.242211 (MainThread): Acquiring new bigquery connection "model.salesforce.opportunity_aggregation_by_owner".
2020-05-05 23:22:23.242301 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:22:23.248922 (MainThread): Acquiring new bigquery connection "model.salesforce.stg_salesforce_opportunity".
2020-05-05 23:22:23.249007 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:22:23.257423 (MainThread): Acquiring new bigquery connection "model.salesforce.stg_salesforce_user".
2020-05-05 23:22:23.257531 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:22:23.262310 (MainThread): Acquiring new bigquery connection "model.salesforce.stg_salesforce_user_role".
2020-05-05 23:22:23.262385 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:22:23.266926 (MainThread): Acquiring new bigquery connection "model.salesforce.stg_salesforce_account".
2020-05-05 23:22:23.267001 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:22:23.304187 (MainThread): Acquiring new bigquery connection "test.salesforce.not_null_stg_salesforce_account_account_id".
2020-05-05 23:22:23.304273 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:22:23.311949 (MainThread): Acquiring new bigquery connection "test.salesforce.unique_stg_salesforce_account_account_id".
2020-05-05 23:22:23.312024 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:22:23.319853 (MainThread): Acquiring new bigquery connection "test.salesforce.not_null_stg_salesforce_opportunity_opportunity_id".
2020-05-05 23:22:23.319930 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:22:23.325979 (MainThread): Acquiring new bigquery connection "test.salesforce.unique_stg_salesforce_opportunity_opportunity_id".
2020-05-05 23:22:23.326070 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:22:23.332570 (MainThread): Acquiring new bigquery connection "test.salesforce.not_null_stg_salesforce_user_user_id".
2020-05-05 23:22:23.332690 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:22:23.338751 (MainThread): Acquiring new bigquery connection "test.salesforce.unique_stg_salesforce_user_user_id".
2020-05-05 23:22:23.338827 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:22:23.344828 (MainThread): Acquiring new bigquery connection "test.salesforce.not_null_stg_salesforce_user_role_user_role_id".
2020-05-05 23:22:23.344903 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:22:23.351383 (MainThread): Acquiring new bigquery connection "test.salesforce.unique_stg_salesforce_user_role_user_role_id".
2020-05-05 23:22:23.351459 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:22:23.566449 (MainThread): Found 9 models, 8 tests, 0 snapshots, 0 analyses, 141 macros, 0 operations, 0 seed files, 0 sources
2020-05-05 23:22:23.574361 (MainThread): 
2020-05-05 23:22:23.574944 (MainThread): Acquiring new bigquery connection "master".
2020-05-05 23:22:23.575155 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:22:23.583242 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_digital-arbor-400".
2020-05-05 23:22:23.583477 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2020-05-05 23:22:24.639229 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_digital-arbor-400_dbt_kristin_test".
2020-05-05 23:22:24.639556 (ThreadPoolExecutor-1_0): Re-using an available connection from the pool (formerly list_digital-arbor-400).
2020-05-05 23:22:24.639817 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2020-05-05 23:22:24.785589 (MainThread): 16:22:24 | Concurrency: 4 threads (target='dev')
2020-05-05 23:22:24.785794 (MainThread): 16:22:24 | 
2020-05-05 23:22:24.787821 (Thread-1): Began running node model.salesforce.stg_salesforce_account
2020-05-05 23:22:24.788171 (Thread-1): Acquiring new bigquery connection "model.salesforce.stg_salesforce_account".
2020-05-05 23:22:24.788294 (Thread-1): Re-using an available connection from the pool (formerly list_digital-arbor-400_dbt_kristin_test).
2020-05-05 23:22:24.788418 (Thread-1): Compiling model.salesforce.stg_salesforce_account
2020-05-05 23:22:24.794041 (Thread-2): Began running node model.salesforce.stg_salesforce_opportunity
2020-05-05 23:22:24.794374 (Thread-2): Acquiring new bigquery connection "model.salesforce.stg_salesforce_opportunity".
2020-05-05 23:22:24.794498 (Thread-2): Opening a new connection, currently in state init
2020-05-05 23:22:24.794609 (Thread-2): Compiling model.salesforce.stg_salesforce_opportunity
2020-05-05 23:22:24.807402 (Thread-3): Began running node model.salesforce.stg_salesforce_user
2020-05-05 23:22:24.818195 (Thread-4): Began running node model.salesforce.stg_salesforce_user_role
2020-05-05 23:22:24.826841 (Thread-1): Writing injected SQL for node "model.salesforce.stg_salesforce_account"
2020-05-05 23:22:24.827126 (Thread-3): Acquiring new bigquery connection "model.salesforce.stg_salesforce_user".
2020-05-05 23:22:24.829517 (Thread-4): Acquiring new bigquery connection "model.salesforce.stg_salesforce_user_role".
2020-05-05 23:22:24.829875 (Thread-2): finished collecting timing info
2020-05-05 23:22:24.830233 (Thread-3): Opening a new connection, currently in state init
2020-05-05 23:22:24.830415 (Thread-4): Opening a new connection, currently in state init
2020-05-05 23:22:24.831039 (Thread-3): Compiling model.salesforce.stg_salesforce_user
2020-05-05 23:22:24.831404 (Thread-4): Compiling model.salesforce.stg_salesforce_user_role
2020-05-05 23:22:24.839044 (Thread-3): Writing injected SQL for node "model.salesforce.stg_salesforce_user"
2020-05-05 23:22:24.839372 (Thread-1): finished collecting timing info
2020-05-05 23:22:24.846446 (Thread-4): Writing injected SQL for node "model.salesforce.stg_salesforce_user_role"
2020-05-05 23:22:24.846886 (Thread-1): Finished running node model.salesforce.stg_salesforce_account
2020-05-05 23:22:24.847400 (Thread-3): finished collecting timing info
2020-05-05 23:22:24.847782 (Thread-3): Finished running node model.salesforce.stg_salesforce_user
2020-05-05 23:22:24.848157 (Thread-4): finished collecting timing info
2020-05-05 23:22:24.848556 (Thread-4): Finished running node model.salesforce.stg_salesforce_user_role
2020-05-05 23:22:24.830739 (Thread-2): Compilation Error in model stg_salesforce_opportunity (models/base/stg_salesforce_opportunity.sql)
  'dbt_utils' is undefined
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 386, in catch_jinja
    yield
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 409, in render_template
    return template.render(ctx)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/jinja2/environment.py", line 1090, in render
    self.environment.handle_exception()
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/jinja2/environment.py", line 832, in handle_exception
    reraise(*rewrite_traceback_stack(source=source))
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/jinja2/_compat.py", line 28, in reraise
    raise value.with_traceback(tb)
  File "<template>", line 22, in top-level template code
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 407, in getattr
    value = getattr(obj, attribute)
jinja2.exceptions.UndefinedError: 'dbt_utils' is undefined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 223, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 160, in compile_and_execute
    ctx.node = self.compile(manifest)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 335, in compile
    return compile_node(self.adapter, self.config, self.node, manifest, {})
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/compilation.py", line 250, in compile_node
    node = compiler.compile_node(node, manifest, extra_context)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/compilation.py", line 157, in compile_node
    node)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 415, in get_rendered
    return render_template(template, ctx, node)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 409, in render_template
    return template.render(ctx)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 391, in catch_jinja
    raise CompilationException(str(e), node) from e
dbt.exceptions.CompilationException: Compilation Error in model stg_salesforce_opportunity (models/base/stg_salesforce_opportunity.sql)
  'dbt_utils' is undefined
2020-05-05 23:22:24.849505 (Thread-2): Finished running node model.salesforce.stg_salesforce_opportunity
2020-05-05 23:22:24.849827 (Thread-1): Began running node model.salesforce.salesforce_opportunity_enhanced
2020-05-05 23:22:24.849977 (Thread-1): 16:22:24 | 1 of 4 SKIP relation dbt_kristin_test.salesforce_opportunity_enhanced due to ephemeral model error [ERROR SKIP]
2020-05-05 23:22:24.850101 (Thread-1): Compilation Error in model stg_salesforce_opportunity (models/base/stg_salesforce_opportunity.sql)
2020-05-05 23:22:24.850189 (Thread-1):   'dbt_utils' is undefined
2020-05-05 23:22:24.850288 (Thread-1): Finished running node model.salesforce.salesforce_opportunity_enhanced
2020-05-05 23:22:24.850592 (Thread-4): Began running node model.salesforce.opportunity_aggregation_by_owner
2020-05-05 23:22:24.850728 (Thread-4): Finished running node model.salesforce.opportunity_aggregation_by_owner
2020-05-05 23:22:24.850849 (Thread-4): Began running node model.salesforce.salesforce_sales_snapshot
2020-05-05 23:22:24.850968 (Thread-4): 16:22:24 | 2 of 4 SKIP relation dbt_kristin_test.salesforce_sales_snapshot...... [SKIP]
2020-05-05 23:22:24.851084 (Thread-4): Finished running node model.salesforce.salesforce_sales_snapshot
2020-05-05 23:22:24.851371 (Thread-3): Began running node model.salesforce.salesforce_manager_performance
2020-05-05 23:22:24.851538 (Thread-3): 16:22:24 | 3 of 4 SKIP relation dbt_kristin_test.salesforce_manager_performance. [SKIP]
2020-05-05 23:22:24.851641 (Thread-1): Began running node model.salesforce.salesforce_owner_performance
2020-05-05 23:22:24.851785 (Thread-3): Finished running node model.salesforce.salesforce_manager_performance
2020-05-05 23:22:24.851908 (Thread-1): 16:22:24 | 4 of 4 SKIP relation dbt_kristin_test.salesforce_owner_performance... [SKIP]
2020-05-05 23:22:24.852085 (Thread-1): Finished running node model.salesforce.salesforce_owner_performance
2020-05-05 23:22:24.889657 (MainThread): 16:22:24 | 
2020-05-05 23:22:24.889896 (MainThread): 16:22:24 | Finished running 4 table models in 1.31s.
2020-05-05 23:22:24.890050 (MainThread): Connection 'master' was left open.
2020-05-05 23:22:24.890163 (MainThread): Connection 'model.salesforce.stg_salesforce_account' was left open.
2020-05-05 23:22:24.890271 (MainThread): Connection 'model.salesforce.stg_salesforce_opportunity' was properly closed.
2020-05-05 23:22:24.890371 (MainThread): Connection 'model.salesforce.stg_salesforce_user' was properly closed.
2020-05-05 23:22:24.890471 (MainThread): Connection 'model.salesforce.stg_salesforce_user_role' was properly closed.
2020-05-05 23:22:24.900276 (MainThread): 
2020-05-05 23:22:24.900423 (MainThread): Completed with 1 error and 0 warnings:
2020-05-05 23:22:24.900535 (MainThread): 
2020-05-05 23:22:24.900641 (MainThread): Compilation Error in model.salesforce.salesforce_opportunity_enhanced, caused by compilation error in referenced ephemeral model model.salesforce.stg_salesforce_opportunity
2020-05-05 23:22:24.900748 (MainThread): 
Done. PASS=3 WARN=0 ERROR=1 SKIP=0 TOTAL=4
2020-05-05 23:22:24.900923 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111365450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110b28d50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1116b30d0>]}
2020-05-05 23:22:24.901112 (MainThread): Flushing usage events
2020-05-05 23:23:25.449361 (MainThread): Running with dbt=0.16.0
2020-05-05 23:23:25.584760 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, exclude=None, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/Users/kristin/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', single_threaded=False, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2020-05-05 23:23:25.585890 (MainThread): Tracking: tracking
2020-05-05 23:23:25.591308 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103597e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103597dd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1035976d0>]}
2020-05-05 23:23:25.608484 (MainThread): Partial parsing not enabled
2020-05-05 23:23:25.610110 (MainThread): Parsing macros/core.sql
2020-05-05 23:23:25.614356 (MainThread): Parsing macros/materializations/helpers.sql
2020-05-05 23:23:25.621368 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2020-05-05 23:23:25.622909 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2020-05-05 23:23:25.638351 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2020-05-05 23:23:25.667855 (MainThread): Parsing macros/materializations/seed/seed.sql
2020-05-05 23:23:25.686691 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2020-05-05 23:23:25.688383 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2020-05-05 23:23:25.693991 (MainThread): Parsing macros/materializations/common/merge.sql
2020-05-05 23:23:25.705265 (MainThread): Parsing macros/materializations/table/table.sql
2020-05-05 23:23:25.711390 (MainThread): Parsing macros/materializations/view/view.sql
2020-05-05 23:23:25.717009 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2020-05-05 23:23:25.721435 (MainThread): Parsing macros/etc/get_custom_alias.sql
2020-05-05 23:23:25.722294 (MainThread): Parsing macros/etc/query.sql
2020-05-05 23:23:25.723260 (MainThread): Parsing macros/etc/is_incremental.sql
2020-05-05 23:23:25.724761 (MainThread): Parsing macros/etc/get_relation_comment.sql
2020-05-05 23:23:25.726634 (MainThread): Parsing macros/etc/datetime.sql
2020-05-05 23:23:25.734886 (MainThread): Parsing macros/etc/get_custom_schema.sql
2020-05-05 23:23:25.736698 (MainThread): Parsing macros/etc/get_custom_database.sql
2020-05-05 23:23:25.737652 (MainThread): Parsing macros/adapters/common.sql
2020-05-05 23:23:25.775089 (MainThread): Parsing macros/schema_tests/relationships.sql
2020-05-05 23:23:25.776111 (MainThread): Parsing macros/schema_tests/not_null.sql
2020-05-05 23:23:25.776928 (MainThread): Parsing macros/schema_tests/unique.sql
2020-05-05 23:23:25.777893 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2020-05-05 23:23:25.779937 (MainThread): Parsing macros/etc.sql
2020-05-05 23:23:25.780526 (MainThread): Parsing macros/catalog.sql
2020-05-05 23:23:25.786793 (MainThread): Parsing macros/adapters.sql
2020-05-05 23:23:25.805677 (MainThread): Parsing macros/materializations/seed.sql
2020-05-05 23:23:25.807435 (MainThread): Parsing macros/materializations/view.sql
2020-05-05 23:23:25.808720 (MainThread): Parsing macros/materializations/table.sql
2020-05-05 23:23:25.817670 (MainThread): Parsing macros/materializations/incremental.sql
2020-05-05 23:23:25.829095 (MainThread): Parsing macros/materializations/snapshot.sql
2020-05-05 23:23:25.844705 (MainThread): Partial parsing not enabled
2020-05-05 23:23:25.872073 (MainThread): Acquiring new bigquery connection "model.salesforce.salesforce_sales_snapshot".
2020-05-05 23:23:25.872155 (MainThread): Opening a new connection, currently in state init
2020-05-05 23:23:25.887377 (MainThread): Acquiring new bigquery connection "model.salesforce.salesforce_owner_performance".
2020-05-05 23:23:25.887458 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:23:25.892883 (MainThread): Acquiring new bigquery connection "model.salesforce.salesforce_manager_performance".
2020-05-05 23:23:25.893003 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:23:25.900141 (MainThread): Acquiring new bigquery connection "model.salesforce.salesforce_opportunity_enhanced".
2020-05-05 23:23:25.900216 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:23:25.907216 (MainThread): Acquiring new bigquery connection "model.salesforce.opportunity_aggregation_by_owner".
2020-05-05 23:23:25.907291 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:23:25.913521 (MainThread): Acquiring new bigquery connection "model.salesforce.stg_salesforce_opportunity".
2020-05-05 23:23:25.913608 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:23:25.922134 (MainThread): Acquiring new bigquery connection "model.salesforce.stg_salesforce_user".
2020-05-05 23:23:25.922210 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:23:25.927589 (MainThread): Acquiring new bigquery connection "model.salesforce.stg_salesforce_user_role".
2020-05-05 23:23:25.927672 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:23:25.931896 (MainThread): Acquiring new bigquery connection "model.salesforce.stg_salesforce_account".
2020-05-05 23:23:25.931969 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:23:25.968554 (MainThread): Acquiring new bigquery connection "test.salesforce.not_null_stg_salesforce_account_account_id".
2020-05-05 23:23:25.968639 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:23:25.976373 (MainThread): Acquiring new bigquery connection "test.salesforce.unique_stg_salesforce_account_account_id".
2020-05-05 23:23:25.976449 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:23:25.984415 (MainThread): Acquiring new bigquery connection "test.salesforce.not_null_stg_salesforce_opportunity_opportunity_id".
2020-05-05 23:23:25.984491 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:23:25.990585 (MainThread): Acquiring new bigquery connection "test.salesforce.unique_stg_salesforce_opportunity_opportunity_id".
2020-05-05 23:23:25.990664 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:23:25.997417 (MainThread): Acquiring new bigquery connection "test.salesforce.not_null_stg_salesforce_user_user_id".
2020-05-05 23:23:25.997619 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:23:26.004943 (MainThread): Acquiring new bigquery connection "test.salesforce.unique_stg_salesforce_user_user_id".
2020-05-05 23:23:26.005026 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:23:26.011075 (MainThread): Acquiring new bigquery connection "test.salesforce.not_null_stg_salesforce_user_role_user_role_id".
2020-05-05 23:23:26.011151 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:23:26.017698 (MainThread): Acquiring new bigquery connection "test.salesforce.unique_stg_salesforce_user_role_user_role_id".
2020-05-05 23:23:26.017773 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:23:26.229404 (MainThread): Found 9 models, 8 tests, 0 snapshots, 0 analyses, 141 macros, 0 operations, 0 seed files, 0 sources
2020-05-05 23:23:26.236230 (MainThread): 
2020-05-05 23:23:26.236601 (MainThread): Acquiring new bigquery connection "master".
2020-05-05 23:23:26.236762 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:23:26.250570 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_digital-arbor-400".
2020-05-05 23:23:26.250803 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2020-05-05 23:23:27.358448 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_digital-arbor-400_dbt_kristin_test".
2020-05-05 23:23:27.358774 (ThreadPoolExecutor-1_0): Re-using an available connection from the pool (formerly list_digital-arbor-400).
2020-05-05 23:23:27.359034 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2020-05-05 23:23:27.511696 (MainThread): 16:23:27 | Concurrency: 4 threads (target='dev')
2020-05-05 23:23:27.511894 (MainThread): 16:23:27 | 
2020-05-05 23:23:27.513917 (Thread-1): Began running node model.salesforce.stg_salesforce_account
2020-05-05 23:23:27.514113 (Thread-1): 16:23:27 | 1 of 9 START view model dbt_kristin_test.stg_salesforce_account...... [RUN]
2020-05-05 23:23:27.514297 (Thread-2): Began running node model.salesforce.stg_salesforce_opportunity
2020-05-05 23:23:27.514632 (Thread-1): Acquiring new bigquery connection "model.salesforce.stg_salesforce_account".
2020-05-05 23:23:27.514746 (Thread-3): Began running node model.salesforce.stg_salesforce_user
2020-05-05 23:23:27.514879 (Thread-2): 16:23:27 | 2 of 9 START view model dbt_kristin_test.stg_salesforce_opportunity.. [RUN]
2020-05-05 23:23:27.514985 (Thread-4): Began running node model.salesforce.stg_salesforce_user_role
2020-05-05 23:23:27.515118 (Thread-1): Re-using an available connection from the pool (formerly list_digital-arbor-400_dbt_kristin_test).
2020-05-05 23:23:27.515256 (Thread-3): 16:23:27 | 3 of 9 START view model dbt_kristin_test.stg_salesforce_user......... [RUN]
2020-05-05 23:23:27.515550 (Thread-2): Acquiring new bigquery connection "model.salesforce.stg_salesforce_opportunity".
2020-05-05 23:23:27.515737 (Thread-4): 16:23:27 | 4 of 9 START view model dbt_kristin_test.stg_salesforce_user_role.... [RUN]
2020-05-05 23:23:27.515887 (Thread-1): Compiling model.salesforce.stg_salesforce_account
2020-05-05 23:23:27.516187 (Thread-3): Acquiring new bigquery connection "model.salesforce.stg_salesforce_user".
2020-05-05 23:23:27.516311 (Thread-2): Opening a new connection, currently in state init
2020-05-05 23:23:27.516600 (Thread-4): Acquiring new bigquery connection "model.salesforce.stg_salesforce_user_role".
2020-05-05 23:23:27.521950 (Thread-3): Opening a new connection, currently in state init
2020-05-05 23:23:27.537644 (Thread-1): Writing injected SQL for node "model.salesforce.stg_salesforce_account"
2020-05-05 23:23:27.538126 (Thread-2): Compiling model.salesforce.stg_salesforce_opportunity
2020-05-05 23:23:27.538382 (Thread-4): Opening a new connection, currently in state init
2020-05-05 23:23:27.538505 (Thread-3): Compiling model.salesforce.stg_salesforce_user
2020-05-05 23:23:27.550151 (Thread-4): Compiling model.salesforce.stg_salesforce_user_role
2020-05-05 23:23:27.550453 (Thread-1): finished collecting timing info
2020-05-05 23:23:27.558277 (Thread-3): Writing injected SQL for node "model.salesforce.stg_salesforce_user"
2020-05-05 23:23:27.558632 (Thread-2): finished collecting timing info
2020-05-05 23:23:27.565485 (Thread-4): Writing injected SQL for node "model.salesforce.stg_salesforce_user_role"
2020-05-05 23:23:27.602064 (Thread-4): finished collecting timing info
2020-05-05 23:23:27.652372 (Thread-3): finished collecting timing info
2020-05-05 23:23:27.821615 (Thread-4): Writing runtime SQL for node "model.salesforce.stg_salesforce_user_role"
2020-05-05 23:23:27.822120 (Thread-1): Writing runtime SQL for node "model.salesforce.stg_salesforce_account"
2020-05-05 23:23:27.822904 (Thread-3): Writing runtime SQL for node "model.salesforce.stg_salesforce_user"
2020-05-05 23:23:27.577307 (Thread-2): Compilation Error in model stg_salesforce_opportunity (models/base/stg_salesforce_opportunity.sql)
  'dbt_utils' is undefined
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 386, in catch_jinja
    yield
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 409, in render_template
    return template.render(ctx)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/jinja2/environment.py", line 1090, in render
    self.environment.handle_exception()
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/jinja2/environment.py", line 832, in handle_exception
    reraise(*rewrite_traceback_stack(source=source))
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/jinja2/_compat.py", line 28, in reraise
    raise value.with_traceback(tb)
  File "<template>", line 22, in top-level template code
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 407, in getattr
    value = getattr(obj, attribute)
jinja2.exceptions.UndefinedError: 'dbt_utils' is undefined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 223, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 160, in compile_and_execute
    ctx.node = self.compile(manifest)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 335, in compile
    return compile_node(self.adapter, self.config, self.node, manifest, {})
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/compilation.py", line 250, in compile_node
    node = compiler.compile_node(node, manifest, extra_context)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/compilation.py", line 157, in compile_node
    node)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 415, in get_rendered
    return render_template(template, ctx, node)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 409, in render_template
    return template.render(ctx)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 391, in catch_jinja
    raise CompilationException(str(e), node) from e
dbt.exceptions.CompilationException: Compilation Error in model stg_salesforce_opportunity (models/base/stg_salesforce_opportunity.sql)
  'dbt_utils' is undefined
2020-05-05 23:23:27.824385 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a745a6b4-bb5d-46a0-bde7-051c0b7ed660', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1041e6a10>]}
2020-05-05 23:23:27.824621 (Thread-2): 16:23:27 | 2 of 9 ERROR creating view model dbt_kristin_test.stg_salesforce_opportunity [ERROR in 0.31s]
2020-05-05 23:23:27.825322 (Thread-1): On model.salesforce.stg_salesforce_account: /* {"app": "dbt", "dbt_version": "0.16.0", "profile_name": "fivetran", "target_name": "dev", "node_id": "model.salesforce.stg_salesforce_account"} */


  create or replace view `digital-arbor-400`.`dbt_kristin_test`.`stg_salesforce_account`
  OPTIONS()
  as (
    with base as (

    select *
    from salesforce.account
    where not is_deleted

), fields as (

    select 

      id as account_id,
      name as account_name,
      industry,
      number_of_employees,
      account_source,
      rating as account_rating,
      annual_revenue

    from base

)

select *
from fields
  );

2020-05-05 23:23:27.826429 (Thread-2): Finished running node model.salesforce.stg_salesforce_opportunity
2020-05-05 23:23:27.826892 (Thread-3): On model.salesforce.stg_salesforce_user: /* {"app": "dbt", "dbt_version": "0.16.0", "profile_name": "fivetran", "target_name": "dev", "node_id": "model.salesforce.stg_salesforce_user"} */


  create or replace view `digital-arbor-400`.`dbt_kristin_test`.`stg_salesforce_user`
  OPTIONS()
  as (
    with base as (

    select *
    from salesforce.user

), fields as (

    select 
      id as user_id,
      name,
      city,
      state,
      manager_id,
      user_role_id
    from base

)

select *
from fields
  );

2020-05-05 23:23:27.828272 (Thread-4): On model.salesforce.stg_salesforce_user_role: /* {"app": "dbt", "dbt_version": "0.16.0", "profile_name": "fivetran", "target_name": "dev", "node_id": "model.salesforce.stg_salesforce_user_role"} */


  create or replace view `digital-arbor-400`.`dbt_kristin_test`.`stg_salesforce_user_role`
  OPTIONS()
  as (
    with base as (

    select *
    from salesforce.user_role
    where not _fivetran_deleted

), fields as (

    select 

      id as user_role_id,
      name as role_name

    from base

)

select *
from fields
  );

2020-05-05 23:23:28.308821 (Thread-1): finished collecting timing info
2020-05-05 23:23:28.309608 (Thread-1): Database Error in model stg_salesforce_account (models/base/stg_salesforce_account.sql)
  Within a standard SQL view, references to tables/views require explicit project IDs, but these references are not project-qualified: "salesforce.account"
  compiled SQL at target/run/salesforce/base/stg_salesforce_account.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 80, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 350, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 212, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 339, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3196, in result
    super(QueryJob, self).result(retry=retry, timeout=timeout)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 818, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 122, in result
    self._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3098, in _blocking_poll
    super(QueryJob, self)._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 101, in _blocking_poll
    retry_(self._done_or_raise)()
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 80, in _done_or_raise
    if not self.done():
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3085, in done
    timeout=timeout,
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 1287, in _get_query_results
    retry, method="GET", path=path, query_params=extra_params, timeout=timeout
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 556, in _call_api
    return call()
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/google/cloud/_http.py", line 423, in api_request
    raise exceptions.from_http_response(response)
google.api_core.exceptions.BadRequest: 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/digital-arbor-400/queries/bd000707-3586-4892-ba26-d37879eb8f4e?maxResults=0&location=US: Within a standard SQL view, references to tables/views require explicit project IDs, but these references are not project-qualified: "salesforce.account"

(job ID: bd000707-3586-4892-ba26-d37879eb8f4e)

                                                             -----Query Job SQL Follows-----                                                              

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.16.0", "profile_name": "fivetran", "target_name": "dev", "node_id": "model.salesforce.stg_salesforce_account"} */
   2:
   3:
   4:  create or replace view `digital-arbor-400`.`dbt_kristin_test`.`stg_salesforce_account`
   5:  OPTIONS()
   6:  as (
   7:    with base as (
   8:
   9:    select *
  10:    from salesforce.account
  11:    where not is_deleted
  12:
  13:), fields as (
  14:
  15:    select 
  16:
  17:      id as account_id,
  18:      name as account_name,
  19:      industry,
  20:      number_of_employees,
  21:      account_source,
  22:      rating as account_rating,
  23:      annual_revenue
  24:
  25:    from base
  26:
  27:)
  28:
  29:select *
  30:from fields
  31:  );
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 223, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 166, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 268, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 450, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 231, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 161, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 231, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 161, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 99, in macro
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 231, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 161, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 220, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 221, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 214, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 350, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 84, in exception_handler
    self.handle_error(e, message)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 72, in handle_error
    raise DatabaseException(error_msg)
dbt.exceptions.DatabaseException: Database Error in model stg_salesforce_account (models/base/stg_salesforce_account.sql)
  Within a standard SQL view, references to tables/views require explicit project IDs, but these references are not project-qualified: "salesforce.account"
  compiled SQL at target/run/salesforce/base/stg_salesforce_account.sql
2020-05-05 23:23:28.328002 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a745a6b4-bb5d-46a0-bde7-051c0b7ed660', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1040d8890>]}
2020-05-05 23:23:28.328339 (Thread-1): 16:23:28 | 1 of 9 ERROR creating view model dbt_kristin_test.stg_salesforce_account [ERROR in 0.81s]
2020-05-05 23:23:28.328526 (Thread-1): Finished running node model.salesforce.stg_salesforce_account
2020-05-05 23:23:28.501637 (Thread-4): finished collecting timing info
2020-05-05 23:23:28.502388 (Thread-4): Database Error in model stg_salesforce_user_role (models/base/stg_salesforce_user_role.sql)
  Within a standard SQL view, references to tables/views require explicit project IDs, but these references are not project-qualified: "salesforce.user_role"
  compiled SQL at target/run/salesforce/base/stg_salesforce_user_role.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 80, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 350, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 212, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 339, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3196, in result
    super(QueryJob, self).result(retry=retry, timeout=timeout)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 818, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 122, in result
    self._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3098, in _blocking_poll
    super(QueryJob, self)._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 101, in _blocking_poll
    retry_(self._done_or_raise)()
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 80, in _done_or_raise
    if not self.done():
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3085, in done
    timeout=timeout,
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 1287, in _get_query_results
    retry, method="GET", path=path, query_params=extra_params, timeout=timeout
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 556, in _call_api
    return call()
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/google/cloud/_http.py", line 423, in api_request
    raise exceptions.from_http_response(response)
google.api_core.exceptions.BadRequest: 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/digital-arbor-400/queries/8b50bb51-4132-4f68-aa9b-7184e34e39cd?maxResults=0&location=US: Within a standard SQL view, references to tables/views require explicit project IDs, but these references are not project-qualified: "salesforce.user_role"

(job ID: 8b50bb51-4132-4f68-aa9b-7184e34e39cd)

                                                              -----Query Job SQL Follows-----                                                               

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.16.0", "profile_name": "fivetran", "target_name": "dev", "node_id": "model.salesforce.stg_salesforce_user_role"} */
   2:
   3:
   4:  create or replace view `digital-arbor-400`.`dbt_kristin_test`.`stg_salesforce_user_role`
   5:  OPTIONS()
   6:  as (
   7:    with base as (
   8:
   9:    select *
  10:    from salesforce.user_role
  11:    where not _fivetran_deleted
  12:
  13:), fields as (
  14:
  15:    select 
  16:
  17:      id as user_role_id,
  18:      name as role_name
  19:
  20:    from base
  21:
  22:)
  23:
  24:select *
  25:from fields
  26:  );
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 223, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 166, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 268, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 450, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 231, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 161, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 231, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 161, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 99, in macro
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 231, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 161, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 220, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 221, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 214, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 350, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 84, in exception_handler
    self.handle_error(e, message)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 72, in handle_error
    raise DatabaseException(error_msg)
dbt.exceptions.DatabaseException: Database Error in model stg_salesforce_user_role (models/base/stg_salesforce_user_role.sql)
  Within a standard SQL view, references to tables/views require explicit project IDs, but these references are not project-qualified: "salesforce.user_role"
  compiled SQL at target/run/salesforce/base/stg_salesforce_user_role.sql
2020-05-05 23:23:28.503583 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a745a6b4-bb5d-46a0-bde7-051c0b7ed660', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1040d8050>]}
2020-05-05 23:23:28.503861 (Thread-4): 16:23:28 | 4 of 9 ERROR creating view model dbt_kristin_test.stg_salesforce_user_role [ERROR in 0.99s]
2020-05-05 23:23:28.504033 (Thread-4): Finished running node model.salesforce.stg_salesforce_user_role
2020-05-05 23:23:28.538528 (Thread-3): finished collecting timing info
2020-05-05 23:23:28.539311 (Thread-3): Database Error in model stg_salesforce_user (models/base/stg_salesforce_user.sql)
  Within a standard SQL view, references to tables/views require explicit project IDs, but these references are not project-qualified: "salesforce.user"
  compiled SQL at target/run/salesforce/base/stg_salesforce_user.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 80, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 350, in _retry_and_handle
    deadline=None)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 212, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 339, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3196, in result
    super(QueryJob, self).result(retry=retry, timeout=timeout)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 818, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 122, in result
    self._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3098, in _blocking_poll
    super(QueryJob, self)._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 101, in _blocking_poll
    retry_(self._done_or_raise)()
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/google/api_core/future/polling.py", line 80, in _done_or_raise
    if not self.done():
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/job.py", line 3085, in done
    timeout=timeout,
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 1287, in _get_query_results
    retry, method="GET", path=path, query_params=extra_params, timeout=timeout
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/google/cloud/bigquery/client.py", line 556, in _call_api
    return call()
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 286, in retry_wrapped_func
    on_error=on_error,
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/google/cloud/_http.py", line 423, in api_request
    raise exceptions.from_http_response(response)
google.api_core.exceptions.BadRequest: 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/digital-arbor-400/queries/5eee8eb2-691a-4e2b-b2e4-8222cbd90463?maxResults=0&location=US: Within a standard SQL view, references to tables/views require explicit project IDs, but these references are not project-qualified: "salesforce.user"

(job ID: 5eee8eb2-691a-4e2b-b2e4-8222cbd90463)

                                                            -----Query Job SQL Follows-----                                                            

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.16.0", "profile_name": "fivetran", "target_name": "dev", "node_id": "model.salesforce.stg_salesforce_user"} */
   2:
   3:
   4:  create or replace view `digital-arbor-400`.`dbt_kristin_test`.`stg_salesforce_user`
   5:  OPTIONS()
   6:  as (
   7:    with base as (
   8:
   9:    select *
  10:    from salesforce.user
  11:
  12:), fields as (
  13:
  14:    select 
  15:      id as user_id,
  16:      name,
  17:      city,
  18:      state,
  19:      manager_id,
  20:      user_role_id
  21:    from base
  22:
  23:)
  24:
  25:select *
  26:from fields
  27:  );
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 223, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 166, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 268, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/node_runners.py", line 450, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 231, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 161, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 231, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 161, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 99, in macro
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 231, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/clients/jinja.py", line 161, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/adapters/base/impl.py", line 220, in execute
    fetch=fetch
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 221, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 214, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 350, in _retry_and_handle
    deadline=None)
  File "/usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 84, in exception_handler
    self.handle_error(e, message)
  File "/usr/local/Cellar/dbt/0.16.0_1/libexec/lib/python3.7/site-packages/dbt/adapters/bigquery/connections.py", line 72, in handle_error
    raise DatabaseException(error_msg)
dbt.exceptions.DatabaseException: Database Error in model stg_salesforce_user (models/base/stg_salesforce_user.sql)
  Within a standard SQL view, references to tables/views require explicit project IDs, but these references are not project-qualified: "salesforce.user"
  compiled SQL at target/run/salesforce/base/stg_salesforce_user.sql
2020-05-05 23:23:28.540478 (Thread-3): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a745a6b4-bb5d-46a0-bde7-051c0b7ed660', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10415c9d0>]}
2020-05-05 23:23:28.540765 (Thread-3): 16:23:28 | 3 of 9 ERROR creating view model dbt_kristin_test.stg_salesforce_user [ERROR in 1.02s]
2020-05-05 23:23:28.540949 (Thread-3): Finished running node model.salesforce.stg_salesforce_user
2020-05-05 23:23:28.541420 (Thread-2): Began running node model.salesforce.salesforce_opportunity_enhanced
2020-05-05 23:23:28.541635 (Thread-2): 16:23:28 | 5 of 9 SKIP relation dbt_kristin_test.salesforce_opportunity_enhanced [SKIP]
2020-05-05 23:23:28.541819 (Thread-2): Finished running node model.salesforce.salesforce_opportunity_enhanced
2020-05-05 23:23:28.542209 (Thread-4): Began running node model.salesforce.opportunity_aggregation_by_owner
2020-05-05 23:23:28.542416 (Thread-4): 16:23:28 | 6 of 9 SKIP relation dbt_kristin_test.opportunity_aggregation_by_owner [SKIP]
2020-05-05 23:23:28.542591 (Thread-4): Finished running node model.salesforce.opportunity_aggregation_by_owner
2020-05-05 23:23:28.542757 (Thread-4): Began running node model.salesforce.salesforce_sales_snapshot
2020-05-05 23:23:28.543138 (Thread-4): 16:23:28 | 7 of 9 SKIP relation dbt_kristin_test.salesforce_sales_snapshot...... [SKIP]
2020-05-05 23:23:28.543334 (Thread-4): Finished running node model.salesforce.salesforce_sales_snapshot
2020-05-05 23:23:28.543643 (Thread-1): Began running node model.salesforce.salesforce_manager_performance
2020-05-05 23:23:28.543817 (Thread-2): Began running node model.salesforce.salesforce_owner_performance
2020-05-05 23:23:28.543962 (Thread-1): 16:23:28 | 8 of 9 SKIP relation dbt_kristin_test.salesforce_manager_performance. [SKIP]
2020-05-05 23:23:28.544113 (Thread-2): 16:23:28 | 9 of 9 SKIP relation dbt_kristin_test.salesforce_owner_performance... [SKIP]
2020-05-05 23:23:28.544261 (Thread-1): Finished running node model.salesforce.salesforce_manager_performance
2020-05-05 23:23:28.544450 (Thread-2): Finished running node model.salesforce.salesforce_owner_performance
2020-05-05 23:23:28.563830 (MainThread): 16:23:28 | 
2020-05-05 23:23:28.564037 (MainThread): 16:23:28 | Finished running 9 view models in 2.33s.
2020-05-05 23:23:28.564163 (MainThread): Connection 'master' was left open.
2020-05-05 23:23:28.564255 (MainThread): Connection 'model.salesforce.stg_salesforce_account' was left open.
2020-05-05 23:23:28.564340 (MainThread): Connection 'model.salesforce.stg_salesforce_opportunity' was properly closed.
2020-05-05 23:23:28.564422 (MainThread): Connection 'model.salesforce.stg_salesforce_user' was left open.
2020-05-05 23:23:28.564502 (MainThread): Connection 'model.salesforce.stg_salesforce_user_role' was left open.
2020-05-05 23:23:28.589062 (MainThread): 
2020-05-05 23:23:28.589547 (MainThread): Completed with 4 errors and 0 warnings:
2020-05-05 23:23:28.589777 (MainThread): 
2020-05-05 23:23:28.589905 (MainThread): Compilation Error in model stg_salesforce_opportunity (models/base/stg_salesforce_opportunity.sql)
2020-05-05 23:23:28.590008 (MainThread):   'dbt_utils' is undefined
2020-05-05 23:23:28.590108 (MainThread): 
2020-05-05 23:23:28.590211 (MainThread): Database Error in model stg_salesforce_account (models/base/stg_salesforce_account.sql)
2020-05-05 23:23:28.590307 (MainThread):   Within a standard SQL view, references to tables/views require explicit project IDs, but these references are not project-qualified: "salesforce.account"
2020-05-05 23:23:28.590397 (MainThread):   compiled SQL at target/run/salesforce/base/stg_salesforce_account.sql
2020-05-05 23:23:28.590626 (MainThread): 
2020-05-05 23:23:28.590756 (MainThread): Database Error in model stg_salesforce_user_role (models/base/stg_salesforce_user_role.sql)
2020-05-05 23:23:28.590861 (MainThread):   Within a standard SQL view, references to tables/views require explicit project IDs, but these references are not project-qualified: "salesforce.user_role"
2020-05-05 23:23:28.590954 (MainThread):   compiled SQL at target/run/salesforce/base/stg_salesforce_user_role.sql
2020-05-05 23:23:28.591051 (MainThread): 
2020-05-05 23:23:28.591152 (MainThread): Database Error in model stg_salesforce_user (models/base/stg_salesforce_user.sql)
2020-05-05 23:23:28.591246 (MainThread):   Within a standard SQL view, references to tables/views require explicit project IDs, but these references are not project-qualified: "salesforce.user"
2020-05-05 23:23:28.591336 (MainThread):   compiled SQL at target/run/salesforce/base/stg_salesforce_user.sql
2020-05-05 23:23:28.591437 (MainThread): 
Done. PASS=5 WARN=0 ERROR=4 SKIP=0 TOTAL=9
2020-05-05 23:23:28.591620 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103c5e450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10412d4d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10412d090>]}
2020-05-05 23:23:28.591810 (MainThread): Flushing usage events
2020-05-05 23:23:58.284791 (MainThread): Running with dbt=0.16.0
2020-05-05 23:23:58.425372 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.deps.DepsTask'>, debug=False, log_cache_events=False, log_format='default', partial_parse=None, profile=None, profiles_dir='/Users/kristin/.dbt', project_dir=None, record_timing_info=None, rpc_method='deps', single_threaded=False, strict=False, target=None, test_new_parser=False, use_cache=True, vars='{}', warn_error=False, which='deps', write_json=True)
2020-05-05 23:23:58.426460 (MainThread): Tracking: tracking
2020-05-05 23:23:58.432096 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b904950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b8f4650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10be34e10>]}
2020-05-05 23:23:58.433484 (MainThread): Set downloads directory='/var/folders/sk/bwywl8692vlbvlbk71j59w780000gp/T/dbt-downloads-950c7p08'
2020-05-05 23:23:58.434561 (MainThread): Using or importing the ABCs from 'collections' instead of from 'collections.abc' is deprecated since Python 3.3,and in 3.9 it will stop working
2020-05-05 23:23:58.434665 (MainThread): Making package registry request: GET https://hub.getdbt.com/api/v1/index.json
2020-05-05 23:23:58.729962 (MainThread): Response from registry: GET https://hub.getdbt.com/api/v1/index.json 200
2020-05-05 23:23:58.730289 (MainThread): Making package registry request: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils.json
2020-05-05 23:23:58.785778 (MainThread): Response from registry: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils.json 200
2020-05-05 23:23:58.798237 (MainThread): Making package registry request: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils/0.3.0.json
2020-05-05 23:23:58.854215 (MainThread): Response from registry: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils/0.3.0.json 200
2020-05-05 23:23:58.859768 (MainThread): Making package registry request: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils.json
2020-05-05 23:23:58.912868 (MainThread): Response from registry: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils.json 200
2020-05-05 23:23:58.924024 (MainThread): Making package registry request: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils/0.3.0.json
2020-05-05 23:23:58.979262 (MainThread): Response from registry: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils/0.3.0.json 200
2020-05-05 23:23:58.980516 (MainThread): Installing fishtown-analytics/dbt_utils@0.3.0
2020-05-05 23:23:59.210866 (MainThread):   Installed from version 0.3.0

2020-05-05 23:23:59.211132 (MainThread): Sending event: {'category': 'dbt', 'action': 'package', 'label': '216346cd-a9a4-4561-aeb2-f81c9460e330', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b8ce950>]}
2020-05-05 23:23:59.211969 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b8f4650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b003450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10be224d0>]}
2020-05-05 23:23:59.212227 (MainThread): Flushing usage events
2020-05-05 23:24:02.579136 (MainThread): Running with dbt=0.16.0
2020-05-05 23:24:02.718477 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, exclude=None, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/Users/kristin/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', single_threaded=False, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2020-05-05 23:24:02.719266 (MainThread): Tracking: tracking
2020-05-05 23:24:02.724440 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10589bb90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1058b5350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10589b210>]}
2020-05-05 23:24:02.741343 (MainThread): Partial parsing not enabled
2020-05-05 23:24:02.743511 (MainThread): Parsing macros/core.sql
2020-05-05 23:24:02.747396 (MainThread): Parsing macros/materializations/helpers.sql
2020-05-05 23:24:02.754698 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2020-05-05 23:24:02.756386 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2020-05-05 23:24:02.772118 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2020-05-05 23:24:02.802460 (MainThread): Parsing macros/materializations/seed/seed.sql
2020-05-05 23:24:02.821316 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2020-05-05 23:24:02.823020 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2020-05-05 23:24:02.828693 (MainThread): Parsing macros/materializations/common/merge.sql
2020-05-05 23:24:02.839983 (MainThread): Parsing macros/materializations/table/table.sql
2020-05-05 23:24:02.846580 (MainThread): Parsing macros/materializations/view/view.sql
2020-05-05 23:24:02.852263 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2020-05-05 23:24:02.856748 (MainThread): Parsing macros/etc/get_custom_alias.sql
2020-05-05 23:24:02.857614 (MainThread): Parsing macros/etc/query.sql
2020-05-05 23:24:02.858606 (MainThread): Parsing macros/etc/is_incremental.sql
2020-05-05 23:24:02.860132 (MainThread): Parsing macros/etc/get_relation_comment.sql
2020-05-05 23:24:02.862219 (MainThread): Parsing macros/etc/datetime.sql
2020-05-05 23:24:02.870196 (MainThread): Parsing macros/etc/get_custom_schema.sql
2020-05-05 23:24:02.872045 (MainThread): Parsing macros/etc/get_custom_database.sql
2020-05-05 23:24:02.872998 (MainThread): Parsing macros/adapters/common.sql
2020-05-05 23:24:02.910821 (MainThread): Parsing macros/schema_tests/relationships.sql
2020-05-05 23:24:02.911964 (MainThread): Parsing macros/schema_tests/not_null.sql
2020-05-05 23:24:02.912798 (MainThread): Parsing macros/schema_tests/unique.sql
2020-05-05 23:24:02.913789 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2020-05-05 23:24:02.915869 (MainThread): Parsing macros/etc.sql
2020-05-05 23:24:02.916481 (MainThread): Parsing macros/catalog.sql
2020-05-05 23:24:02.922725 (MainThread): Parsing macros/adapters.sql
2020-05-05 23:24:02.941626 (MainThread): Parsing macros/materializations/seed.sql
2020-05-05 23:24:02.943402 (MainThread): Parsing macros/materializations/view.sql
2020-05-05 23:24:02.944698 (MainThread): Parsing macros/materializations/table.sql
2020-05-05 23:24:02.953506 (MainThread): Parsing macros/materializations/incremental.sql
2020-05-05 23:24:02.965048 (MainThread): Parsing macros/materializations/snapshot.sql
2020-05-05 23:24:02.989550 (MainThread): Partial parsing not enabled
2020-05-05 23:24:02.991174 (MainThread): Parsing macros/cross_db_utils/except.sql
2020-05-05 23:24:02.992106 (MainThread): Parsing macros/cross_db_utils/replace.sql
2020-05-05 23:24:02.993213 (MainThread): Parsing macros/cross_db_utils/concat.sql
2020-05-05 23:24:02.995238 (MainThread): Parsing macros/cross_db_utils/identifer.sql
2020-05-05 23:24:02.996355 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2020-05-05 23:24:03.001280 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2020-05-05 23:24:03.002492 (MainThread): Parsing macros/cross_db_utils/length.sql
2020-05-05 23:24:03.003626 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2020-05-05 23:24:03.005756 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2020-05-05 23:24:03.006675 (MainThread): Parsing macros/cross_db_utils/right.sql
2020-05-05 23:24:03.008802 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2020-05-05 23:24:03.017405 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2020-05-05 23:24:03.019107 (MainThread): Parsing macros/cross_db_utils/hash.sql
2020-05-05 23:24:03.020370 (MainThread): Parsing macros/cross_db_utils/position.sql
2020-05-05 23:24:03.021763 (MainThread): Parsing macros/cross_db_utils/literal.sql
2020-05-05 23:24:03.022753 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2020-05-05 23:24:03.025470 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2020-05-05 23:24:03.030325 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2020-05-05 23:24:03.032790 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2020-05-05 23:24:03.034487 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2020-05-05 23:24:03.035850 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2020-05-05 23:24:03.056856 (MainThread): Parsing macros/logger/pretty_log_format.sql
2020-05-05 23:24:03.057476 (MainThread): Parsing macros/logger/pretty_time.sql
2020-05-05 23:24:03.058155 (MainThread): Parsing macros/logger/log_info.sql
2020-05-05 23:24:03.058787 (MainThread): Parsing macros/datetime/date_spine.sql
2020-05-05 23:24:03.061783 (MainThread): Parsing macros/web/get_url_host.sql
2020-05-05 23:24:03.063014 (MainThread): Parsing macros/web/get_url_path.sql
2020-05-05 23:24:03.064956 (MainThread): Parsing macros/web/get_url_parameter.sql
2020-05-05 23:24:03.065956 (MainThread): Parsing macros/geo/haversine_distance.sql
2020-05-05 23:24:03.066786 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2020-05-05 23:24:03.067942 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2020-05-05 23:24:03.069756 (MainThread): Parsing macros/schema_tests/recency.sql
2020-05-05 23:24:03.070872 (MainThread): Parsing macros/schema_tests/not_constant.sql
2020-05-05 23:24:03.071772 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2020-05-05 23:24:03.072654 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2020-05-05 23:24:03.073800 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2020-05-05 23:24:03.075189 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2020-05-05 23:24:03.076163 (MainThread): Parsing macros/schema_tests/equality.sql
2020-05-05 23:24:03.078854 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2020-05-05 23:24:03.084140 (MainThread): Parsing macros/sql/nullcheck_table.sql
2020-05-05 23:24:03.085058 (MainThread): Parsing macros/sql/generate_series.sql
2020-05-05 23:24:03.088382 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2020-05-05 23:24:03.091621 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2020-05-05 23:24:03.093957 (MainThread): Parsing macros/sql/star.sql
2020-05-05 23:24:03.096352 (MainThread): Parsing macros/sql/unpivot.sql
2020-05-05 23:24:03.101792 (MainThread): Parsing macros/sql/union.sql
2020-05-05 23:24:03.111159 (MainThread): Parsing macros/sql/groupby.sql
2020-05-05 23:24:03.111991 (MainThread): Parsing macros/sql/surrogate_key.sql
2020-05-05 23:24:03.114305 (MainThread): Parsing macros/sql/safe_add.sql
2020-05-05 23:24:03.115230 (MainThread): Parsing macros/sql/nullcheck.sql
2020-05-05 23:24:03.116334 (MainThread): Parsing macros/sql/get_column_values.sql
2020-05-05 23:24:03.120199 (MainThread): Parsing macros/sql/pivot.sql
2020-05-05 23:24:03.122492 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2020-05-05 23:24:03.158449 (MainThread): Acquiring new bigquery connection "model.salesforce.salesforce_sales_snapshot".
2020-05-05 23:24:03.158562 (MainThread): Opening a new connection, currently in state init
2020-05-05 23:24:03.172789 (MainThread): Acquiring new bigquery connection "model.salesforce.salesforce_owner_performance".
2020-05-05 23:24:03.172873 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:24:03.179025 (MainThread): Acquiring new bigquery connection "model.salesforce.salesforce_manager_performance".
2020-05-05 23:24:03.179103 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:24:03.185947 (MainThread): Acquiring new bigquery connection "model.salesforce.salesforce_opportunity_enhanced".
2020-05-05 23:24:03.186026 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:24:03.192661 (MainThread): Acquiring new bigquery connection "model.salesforce.opportunity_aggregation_by_owner".
2020-05-05 23:24:03.192743 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:24:03.198599 (MainThread): Acquiring new bigquery connection "model.salesforce.stg_salesforce_opportunity".
2020-05-05 23:24:03.198680 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:24:03.303264 (MainThread): Acquiring new bigquery connection "model.salesforce.stg_salesforce_user".
2020-05-05 23:24:03.303418 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:24:03.310352 (MainThread): Acquiring new bigquery connection "model.salesforce.stg_salesforce_user_role".
2020-05-05 23:24:03.310472 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:24:03.317132 (MainThread): Acquiring new bigquery connection "model.salesforce.stg_salesforce_account".
2020-05-05 23:24:03.317248 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:24:03.362021 (MainThread): Acquiring new bigquery connection "test.salesforce.not_null_stg_salesforce_account_account_id".
2020-05-05 23:24:03.362105 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:24:03.369742 (MainThread): Acquiring new bigquery connection "test.salesforce.unique_stg_salesforce_account_account_id".
2020-05-05 23:24:03.369820 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:24:03.379031 (MainThread): Acquiring new bigquery connection "test.salesforce.not_null_stg_salesforce_opportunity_opportunity_id".
2020-05-05 23:24:03.379140 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:24:03.385308 (MainThread): Acquiring new bigquery connection "test.salesforce.unique_stg_salesforce_opportunity_opportunity_id".
2020-05-05 23:24:03.385386 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:24:03.391539 (MainThread): Acquiring new bigquery connection "test.salesforce.not_null_stg_salesforce_user_user_id".
2020-05-05 23:24:03.391617 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:24:03.397707 (MainThread): Acquiring new bigquery connection "test.salesforce.unique_stg_salesforce_user_user_id".
2020-05-05 23:24:03.397784 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:24:03.403972 (MainThread): Acquiring new bigquery connection "test.salesforce.not_null_stg_salesforce_user_role_user_role_id".
2020-05-05 23:24:03.404050 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:24:03.410451 (MainThread): Acquiring new bigquery connection "test.salesforce.unique_stg_salesforce_user_role_user_role_id".
2020-05-05 23:24:03.410532 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:24:03.697853 (MainThread): Found 9 models, 8 tests, 0 snapshots, 0 analyses, 268 macros, 0 operations, 0 seed files, 0 sources
2020-05-05 23:24:03.706708 (MainThread): 
2020-05-05 23:24:03.707390 (MainThread): Acquiring new bigquery connection "master".
2020-05-05 23:24:03.707545 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:24:03.716366 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_digital-arbor-400".
2020-05-05 23:24:03.716496 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2020-05-05 23:24:04.782578 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_digital-arbor-400_dbt_kristin_test".
2020-05-05 23:24:04.782941 (ThreadPoolExecutor-1_0): Re-using an available connection from the pool (formerly list_digital-arbor-400).
2020-05-05 23:24:04.783225 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2020-05-05 23:24:04.915379 (MainThread): 16:24:04 | Concurrency: 4 threads (target='dev')
2020-05-05 23:24:04.915657 (MainThread): 16:24:04 | 
2020-05-05 23:24:04.917634 (Thread-1): Began running node model.salesforce.stg_salesforce_account
2020-05-05 23:24:04.917847 (Thread-2): Began running node model.salesforce.stg_salesforce_opportunity
2020-05-05 23:24:04.918167 (Thread-1): Acquiring new bigquery connection "model.salesforce.stg_salesforce_account".
2020-05-05 23:24:04.918285 (Thread-3): Began running node model.salesforce.stg_salesforce_user
2020-05-05 23:24:04.918460 (Thread-4): Began running node model.salesforce.stg_salesforce_user_role
2020-05-05 23:24:04.918774 (Thread-2): Acquiring new bigquery connection "model.salesforce.stg_salesforce_opportunity".
2020-05-05 23:24:04.918912 (Thread-1): Re-using an available connection from the pool (formerly list_digital-arbor-400_dbt_kristin_test).
2020-05-05 23:24:04.919206 (Thread-3): Acquiring new bigquery connection "model.salesforce.stg_salesforce_user".
2020-05-05 23:24:04.919512 (Thread-4): Acquiring new bigquery connection "model.salesforce.stg_salesforce_user_role".
2020-05-05 23:24:04.919644 (Thread-2): Opening a new connection, currently in state init
2020-05-05 23:24:04.919777 (Thread-1): Compiling model.salesforce.stg_salesforce_account
2020-05-05 23:24:04.919918 (Thread-3): Opening a new connection, currently in state init
2020-05-05 23:24:04.920051 (Thread-4): Opening a new connection, currently in state init
2020-05-05 23:24:04.920177 (Thread-2): Compiling model.salesforce.stg_salesforce_opportunity
2020-05-05 23:24:04.930611 (Thread-3): Compiling model.salesforce.stg_salesforce_user
2020-05-05 23:24:04.940399 (Thread-1): Writing injected SQL for node "model.salesforce.stg_salesforce_account"
2020-05-05 23:24:04.940579 (Thread-4): Compiling model.salesforce.stg_salesforce_user_role
2020-05-05 23:24:04.963578 (Thread-2): Writing injected SQL for node "model.salesforce.stg_salesforce_opportunity"
2020-05-05 23:24:04.964422 (Thread-3): Writing injected SQL for node "model.salesforce.stg_salesforce_user"
2020-05-05 23:24:04.971053 (Thread-4): Writing injected SQL for node "model.salesforce.stg_salesforce_user_role"
2020-05-05 23:24:04.971503 (Thread-2): finished collecting timing info
2020-05-05 23:24:04.971931 (Thread-2): Finished running node model.salesforce.stg_salesforce_opportunity
2020-05-05 23:24:04.972206 (Thread-1): finished collecting timing info
2020-05-05 23:24:04.972581 (Thread-1): Finished running node model.salesforce.stg_salesforce_account
2020-05-05 23:24:04.972768 (Thread-3): finished collecting timing info
2020-05-05 23:24:04.973130 (Thread-3): Finished running node model.salesforce.stg_salesforce_user
2020-05-05 23:24:04.973460 (Thread-2): Began running node model.salesforce.salesforce_opportunity_enhanced
2020-05-05 23:24:04.973616 (Thread-2): 16:24:04 | 1 of 4 START table model dbt_kristin_test.salesforce_opportunity_enhanced [RUN]
2020-05-05 23:24:04.973900 (Thread-2): Acquiring new bigquery connection "model.salesforce.salesforce_opportunity_enhanced".
2020-05-05 23:24:04.974017 (Thread-4): finished collecting timing info
2020-05-05 23:24:04.974202 (Thread-2): Opening a new connection, currently in state closed
2020-05-05 23:24:04.974450 (Thread-4): Finished running node model.salesforce.stg_salesforce_user_role
2020-05-05 23:24:04.974567 (Thread-2): Compiling model.salesforce.salesforce_opportunity_enhanced
2020-05-05 23:24:05.004856 (Thread-2): Writing injected SQL for node "model.salesforce.salesforce_opportunity_enhanced"
2020-05-05 23:24:05.005241 (Thread-2): finished collecting timing info
2020-05-05 23:24:05.039940 (Thread-2): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2020-05-05 23:24:05.559020 (Thread-2): Writing runtime SQL for node "model.salesforce.salesforce_opportunity_enhanced"
2020-05-05 23:24:05.559443 (Thread-2): On model.salesforce.salesforce_opportunity_enhanced: /* {"app": "dbt", "dbt_version": "0.16.0", "profile_name": "fivetran", "target_name": "dev", "node_id": "model.salesforce.salesforce_opportunity_enhanced"} */


  create or replace table `digital-arbor-400`.`dbt_kristin_test`.`salesforce_opportunity_enhanced`
  
  
  OPTIONS()
  as (
    with  __dbt__CTE__stg_salesforce_opportunity as (
with base as (

    select *
    from salesforce.opportunity
    where not is_deleted

), fields as (

    select 

        id as opportunity_id,
        account_id as opportunity_account_id,
        amount,
        probability,
        created_date, 
        is_won,
        is_closed,
        forecast_category,
        stage_name,
        owner_id,
        close_date,
        created_date >= 
    timestamp_trunc(
        cast(
    current_timestamp
 as timestamp),
        month
    )

 as is_created_this_month,
        created_date >= 
    timestamp_trunc(
        cast(
    current_timestamp
 as timestamp),
        quarter
    )

 as is_created_this_quarter,
        
  

    datetime_diff(
        cast(created_date as datetime),
        cast(
    current_timestamp
 as datetime),
        day
    )


 as days_since_created,
        
  

    datetime_diff(
        cast(created_date as datetime),
        cast(close_date as datetime),
        day
    )


 as days_to_close,
        
    timestamp_trunc(
        cast(close_date as timestamp),
        month
    )

 = 
    timestamp_trunc(
        cast(
    current_timestamp
 as timestamp),
        month
    )

 as is_closed_this_month,
        
    timestamp_trunc(
        cast(close_date as timestamp),
        quarter
    )

 = 
    timestamp_trunc(
        cast(
    current_timestamp
 as timestamp),
        quarter
    )

 as is_closed_this_quarter

    from base

)

select *
from fields
),  __dbt__CTE__stg_salesforce_user as (
with base as (

    select *
    from salesforce.user

), fields as (

    select 
      id as user_id,
      name,
      city,
      state,
      manager_id,
      user_role_id
    from base

)

select *
from fields
),  __dbt__CTE__stg_salesforce_account as (
with base as (

    select *
    from salesforce.account
    where not is_deleted

), fields as (

    select 

      id as account_id,
      name as account_name,
      industry,
      number_of_employees,
      account_source,
      rating as account_rating,
      annual_revenue

    from base

)

select *
from fields
),opportunity as (
    
    select *
    from __dbt__CTE__stg_salesforce_opportunity

), user as (

    select *
    from __dbt__CTE__stg_salesforce_user
  
), account as (

    select *
    from __dbt__CTE__stg_salesforce_account
  
), add_fields as (

    select 
      opportunity.* ,
      account.*,
      opportunity_owner.user_id as opportunity_owner_id,
      opportunity_owner.name as opportunity_owner_name,
      opportunity_owner.city opportunity_owner_city,
      opportunity_owner.state as opportunity_owner_state,
      opportunity_manager.user_id as opportunity_manager_id,
      opportunity_manager.name as opportunity_manager_name,
      opportunity_manager.city opportunity_manager_city,
      opportunity_manager.state as opportunity_manager_state,
      case
        when opportunity.is_won then 'Won'
        when not opportunity.is_won and opportunity.is_closed then 'Lost'
        when not opportunity.is_closed and lower(opportunity.forecast_category) in ('pipeline','forecast','bestcase') then 'Pipeline'
        else 'Other'
      end as status,
      case when is_created_this_month then amount else 0 end as created_amount_this_month,
      case when is_created_this_quarter then amount else 0 end as created_amount_this_quarter,
      case when is_created_this_month then 1 else 0 end as created_count_this_month,
      case when is_created_this_quarter then 1 else 0 end as created_count_this_quarter,
      case when is_closed_this_month then amount else 0 end as closed_amount_this_month,
      case when is_closed_this_quarter then amount else 0 end as closed_amount_this_quarter,
      case when is_closed_this_month then 1 else 0 end as closed_count_this_month,
      case when is_closed_this_quarter then 1 else 0 end as closed_count_this_quarter
      
    from opportunity
    left join account on opportunity.opportunity_account_id = account.account_id
    left join user as opportunity_owner on opportunity.owner_id = opportunity_owner.user_id
    left join user as opportunity_manager on opportunity_owner.manager_id = opportunity_manager.user_id
)

select *
from add_fields
  );
    
2020-05-05 23:24:09.433450 (Thread-2): finished collecting timing info
2020-05-05 23:24:09.434360 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '42c0888d-85be-4808-b2a9-56a78545f70d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1068a7090>]}
2020-05-05 23:24:09.434679 (Thread-2): 16:24:09 | 1 of 4 OK created table model dbt_kristin_test.salesforce_opportunity_enhanced [CREATE TABLE (13041) in 4.46s]
2020-05-05 23:24:09.434861 (Thread-2): Finished running node model.salesforce.salesforce_opportunity_enhanced
2020-05-05 23:24:09.435306 (Thread-3): Began running node model.salesforce.opportunity_aggregation_by_owner
2020-05-05 23:24:09.435693 (Thread-3): Acquiring new bigquery connection "model.salesforce.opportunity_aggregation_by_owner".
2020-05-05 23:24:09.435845 (Thread-3): Opening a new connection, currently in state closed
2020-05-05 23:24:09.435963 (Thread-3): Compiling model.salesforce.opportunity_aggregation_by_owner
2020-05-05 23:24:09.441693 (Thread-1): Began running node model.salesforce.salesforce_sales_snapshot
2020-05-05 23:24:09.447327 (Thread-1): 16:24:09 | 2 of 4 START table model dbt_kristin_test.salesforce_sales_snapshot.. [RUN]
2020-05-05 23:24:09.454062 (Thread-1): Acquiring new bigquery connection "model.salesforce.salesforce_sales_snapshot".
2020-05-05 23:24:09.454198 (Thread-1): Re-using an available connection from the pool (formerly model.salesforce.stg_salesforce_account).
2020-05-05 23:24:09.454319 (Thread-1): Compiling model.salesforce.salesforce_sales_snapshot
2020-05-05 23:24:09.468628 (Thread-1): Writing injected SQL for node "model.salesforce.salesforce_sales_snapshot"
2020-05-05 23:24:09.492379 (Thread-3): Writing injected SQL for node "model.salesforce.opportunity_aggregation_by_owner"
2020-05-05 23:24:09.492783 (Thread-1): finished collecting timing info
2020-05-05 23:24:09.497677 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2020-05-05 23:24:09.498673 (Thread-3): finished collecting timing info
2020-05-05 23:24:09.499100 (Thread-3): Finished running node model.salesforce.opportunity_aggregation_by_owner
2020-05-05 23:24:09.499562 (Thread-2): Began running node model.salesforce.salesforce_manager_performance
2020-05-05 23:24:09.499708 (Thread-2): 16:24:09 | 3 of 4 START table model dbt_kristin_test.salesforce_manager_performance [RUN]
2020-05-05 23:24:09.500163 (Thread-2): Acquiring new bigquery connection "model.salesforce.salesforce_manager_performance".
2020-05-05 23:24:09.500263 (Thread-2): Re-using an available connection from the pool (formerly model.salesforce.salesforce_opportunity_enhanced).
2020-05-05 23:24:09.500358 (Thread-2): Compiling model.salesforce.salesforce_manager_performance
2020-05-05 23:24:09.546508 (Thread-4): Began running node model.salesforce.salesforce_owner_performance
2020-05-05 23:24:09.552038 (Thread-4): 16:24:09 | 4 of 4 START table model dbt_kristin_test.salesforce_owner_performance [RUN]
2020-05-05 23:24:09.552636 (Thread-4): Acquiring new bigquery connection "model.salesforce.salesforce_owner_performance".
2020-05-05 23:24:09.559111 (Thread-4): Opening a new connection, currently in state closed
2020-05-05 23:24:09.559367 (Thread-4): Compiling model.salesforce.salesforce_owner_performance
2020-05-05 23:24:09.596438 (Thread-4): Writing injected SQL for node "model.salesforce.salesforce_owner_performance"
2020-05-05 23:24:09.613147 (Thread-2): Writing injected SQL for node "model.salesforce.salesforce_manager_performance"
2020-05-05 23:24:09.613523 (Thread-4): finished collecting timing info
2020-05-05 23:24:09.617282 (Thread-4): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2020-05-05 23:24:09.617716 (Thread-2): finished collecting timing info
2020-05-05 23:24:09.621032 (Thread-2): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2020-05-05 23:24:09.675838 (Thread-1): Writing runtime SQL for node "model.salesforce.salesforce_sales_snapshot"
2020-05-05 23:24:09.676443 (Thread-1): On model.salesforce.salesforce_sales_snapshot: /* {"app": "dbt", "dbt_version": "0.16.0", "profile_name": "fivetran", "target_name": "dev", "node_id": "model.salesforce.salesforce_sales_snapshot"} */


  create or replace table `digital-arbor-400`.`dbt_kristin_test`.`salesforce_sales_snapshot`
  
  
  OPTIONS()
  as (
    with salesforce_opportunity_enhanced as (
    
    select *
    from `digital-arbor-400`.`dbt_kristin_test`.`salesforce_opportunity_enhanced`

), pipeline as (

  select 
    round(sum(created_amount_this_month)) as pipeline_created_amount_this_month,
    round(sum(created_amount_this_quarter)) as pipeline_created_amount_this_quarter,
    round(sum(created_amount_this_month * probability)) as pipeline_created_forecast_amount_this_month,
    round(sum(created_amount_this_quarter * probability)) as pipeline_created_forecast_amount_this_quarter,
    sum(created_count_this_month) as pipeline_count_created_this_month,
    sum(created_count_this_quarter) as pipeline_count_created_this_quarter,
    count(*) as total_number_pipeline,
    round(sum(amount)) as total_pipeline_amount,
    round(sum(amount * probability)) as total_pipeline_forecast_amount,
    round(avg(amount)) as avg_pipeline_opp_amount,
    max(amount) as largest_deal_in_pipeline,
    avg(days_since_created) as avg_days_open
  from salesforce_opportunity_enhanced
  where status = 'Pipeline'

), bookings as (

  select 
    round(sum(closed_amount_this_month)) as bookings_amount_closed_this_month,
    round(sum(closed_amount_this_quarter)) as bookings_amount_closed_this_quarter,
    count(*) as total_number_bookings,
    round(sum(amount)) as total_bookings_amount,
    sum(closed_count_this_month) as bookings_count_closed_this_month,
    sum(closed_count_this_quarter) as bookings_count_closed_this_quarter,
    round(avg(amount)) as avg_bookings_amount,
    max(amount) as largest_booking,
    avg(days_to_close) as avg_days_to_close
  from salesforce_opportunity_enhanced
  where status = 'Won'

), lost as (

  select 
    round(sum(closed_amount_this_month)) as lost_amount_this_month,
    round(sum(closed_amount_this_quarter)) as lost_amount_this_quarter,
    count(*) as total_number_lost,
    round(sum(amount)) as total_lost_amount,
    sum(closed_count_this_month) as lost_count_this_month,
    sum(closed_count_this_quarter) as lost_count_this_quarter
  from salesforce_opportunity_enhanced
  where status = 'Lost'

)

select 
  bookings.*,
  pipeline.*,
  lost.*,
  round((bookings.bookings_amount_closed_this_month / (bookings.bookings_amount_closed_this_month + lost.lost_amount_this_month)) * 100, 2 ) as win_percent_this_month,
  round((bookings.bookings_amount_closed_this_quarter / (bookings.bookings_amount_closed_this_quarter + lost.lost_amount_this_quarter)) * 100, 2 ) as win_percent_this_quarter,
  round((bookings.total_bookings_amount / (bookings.total_bookings_amount + lost.total_lost_amount)) * 100, 2) as win_percent_all_time
from bookings, pipeline, lost
  );
    
2020-05-05 23:24:09.749617 (Thread-2): Writing runtime SQL for node "model.salesforce.salesforce_manager_performance"
2020-05-05 23:24:09.750144 (Thread-2): On model.salesforce.salesforce_manager_performance: /* {"app": "dbt", "dbt_version": "0.16.0", "profile_name": "fivetran", "target_name": "dev", "node_id": "model.salesforce.salesforce_manager_performance"} */


  create or replace table `digital-arbor-400`.`dbt_kristin_test`.`salesforce_manager_performance`
  
  
  OPTIONS()
  as (
    with  __dbt__CTE__stg_salesforce_user as (
with base as (

    select *
    from salesforce.user

), fields as (

    select 
      id as user_id,
      name,
      city,
      state,
      manager_id,
      user_role_id
    from base

)

select *
from fields
),  __dbt__CTE__opportunity_aggregation_by_owner as (
with salesforce_opportunity_enhanced as (
    
    select *
    from `digital-arbor-400`.`dbt_kristin_test`.`salesforce_opportunity_enhanced`
  
), user as (

    select *
    from __dbt__CTE__stg_salesforce_user
  
), booking_by_owner as (

  select 
    opportunity_manager_id as b_manager_id,
    opportunity_owner_id as b_owner_id,
    round(sum(closed_amount_this_month)) as bookings_amount_closed_this_month,
    round(sum(closed_amount_this_quarter)) as bookings_amount_closed_this_quarter,
    count(*) as total_number_bookings,
    round(sum(amount)) as total_bookings_amount,
    sum(closed_count_this_month) as bookings_count_closed_this_month,
    sum(closed_count_this_quarter) as bookings_count_closed_this_quarter,
    round(avg(amount)) as avg_bookings_amount,
    max(amount) as largest_booking,
    avg(days_to_close) as avg_days_to_close
  from salesforce_opportunity_enhanced
  where status = 'Won'
  group by 1, 2

), lost_by_owner as (

  select 
    opportunity_manager_id as l_manager_id,
    opportunity_owner_id as l_owner_id,
    round(sum(closed_amount_this_month)) as lost_amount_this_month,
    round(sum(closed_amount_this_quarter)) as lost_amount_this_quarter,
    count(*) as total_number_lost,
    round(sum(amount)) as total_lost_amount,
    sum(closed_count_this_month) as lost_count_this_month,
    sum(closed_count_this_quarter) as lost_count_this_quarter
  from salesforce_opportunity_enhanced
  where status = 'Lost'
  group by 1, 2

), pipeline_by_owner as (

  select 
    opportunity_manager_id as p_manager_id,
    opportunity_owner_id as p_owner_id,
    round(sum(created_amount_this_month)) as pipeline_created_amount_this_month,
    round(sum(created_amount_this_quarter)) as pipeline_created_amount_this_quarter,
    round(sum(created_amount_this_month * probability)) as pipeline_created_forecast_amount_this_month,
    round(sum(created_amount_this_quarter * probability)) as pipeline_created_forecast_amount_this_quarter,
    sum(created_count_this_month) as pipeline_count_created_this_month,
    sum(created_count_this_quarter) as pipeline_count_created_this_quarter,
    count(*) as total_number_pipeline,
    round(sum(amount)) as total_pipeline_amount,
    round(sum(amount * probability)) as total_pipeline_forecast_amount,
    round(avg(amount)) as avg_pipeline_opp_amount,
    max(amount) as largest_deal_in_pipeline,
    avg(days_since_created) as avg_days_open
  from salesforce_opportunity_enhanced
  where status = 'Pipeline'
  group by 1, 2
)

select 
  user.user_id as owner_id,
  coalesce(p_manager_id, b_manager_id, l_manager_id) as manager_id,
  booking_by_owner.*,
  lost_by_owner.*,
  pipeline_by_owner.*
from user 
left join booking_by_owner on booking_by_owner.b_owner_id = user.user_id
left join lost_by_owner on lost_by_owner.l_owner_id = user.user_id
left join pipeline_by_owner on pipeline_by_owner.p_owner_id = user.user_id
),  __dbt__CTE__stg_salesforce_user_role as (
with base as (

    select *
    from salesforce.user_role
    where not _fivetran_deleted

), fields as (

    select 

      id as user_role_id,
      name as role_name

    from base

)

select *
from fields
),opportunity_aggregation_by_owner as (
    
    select *
    from __dbt__CTE__opportunity_aggregation_by_owner
  
), user as (

    select *
    from __dbt__CTE__stg_salesforce_user
  
), user_role as (

    select *
    from __dbt__CTE__stg_salesforce_user_role
  
)

select 

  coalesce(manager.name, 'No Manager Assigned') as manager_name,
  manager.city as manager_city,
  manager.state as manager_state,
  user_role.role_name as manager_position,
  count(distinct owner_id) as number_of_direct_reports,
  coalesce(sum(bookings_amount_closed_this_month), 0) as bookings_amount_closed_this_month,
  coalesce(sum(bookings_amount_closed_this_quarter), 0) as bookings_amount_closed_this_quarter,
  coalesce(sum(total_number_bookings), 0) as total_number_bookings,
  coalesce(sum(total_bookings_amount), 0) as total_bookings_amount,
  coalesce(sum(bookings_count_closed_this_month), 0) as bookings_count_closed_this_month,
  coalesce(sum(bookings_count_closed_this_quarter), 0) as bookings_count_closed_this_quarter,
  coalesce(max(largest_booking), 0) as largest_booking,
  coalesce(sum(lost_amount_this_month), 0) as lost_amount_this_month,
  coalesce(sum(lost_amount_this_quarter), 0) as lost_amount_this_quarter,
  coalesce(sum(total_number_lost), 0) as total_number_lost,
  coalesce(sum(total_lost_amount), 0) as total_lost_amount,
  coalesce(sum(lost_count_this_month), 0) as lost_count_this_month,
  coalesce(sum(lost_count_this_quarter), 0) as lost_count_this_quarter,
  coalesce(sum(pipeline_created_amount_this_month), 0) as pipeline_created_amount_this_month,
  coalesce(sum(pipeline_created_amount_this_quarter), 0) as pipeline_created_amount_this_quarter,
  coalesce(sum(pipeline_created_forecast_amount_this_month), 0) as pipeline_created_forecast_amount_this_month,
  coalesce(sum(pipeline_created_forecast_amount_this_quarter), 0) as pipeline_created_forecast_amount_this_quarter,
  coalesce(sum(pipeline_count_created_this_month), 0) as pipeline_count_created_this_month,
  coalesce(sum(pipeline_count_created_this_quarter), 0) as pipeline_count_created_this_quarter,
  coalesce(sum(total_number_pipeline), 0) as total_number_pipeline,
  coalesce(sum(total_pipeline_amount), 0) as total_pipeline_amount,
  coalesce(sum(total_pipeline_forecast_amount), 0) as total_pipeline_forecast_amount,
  coalesce(max(largest_deal_in_pipeline), 0) as largest_deal_in_pipeline,
  round(case when sum(bookings_amount_closed_this_month + lost_amount_this_month) > 0 then 
            sum(bookings_amount_closed_this_month) / sum(bookings_amount_closed_this_month + lost_amount_this_month) * 100
            else 0 end, 2) as win_percent_this_month,
  round(case when sum(bookings_amount_closed_this_quarter + lost_amount_this_quarter) > 0 then
            sum(bookings_amount_closed_this_quarter) / sum(bookings_amount_closed_this_quarter + lost_amount_this_quarter) * 100
            else 0 end, 2) as win_percent_this_quarter,
  round(case when sum(total_bookings_amount + total_lost_amount) > 0 then 
            sum(total_bookings_amount) / sum(total_bookings_amount + total_lost_amount) * 100
            else 0 end, 2) as total_win_percent

from opportunity_aggregation_by_owner
left join user as manager on manager.user_id = opportunity_aggregation_by_owner.manager_id
left join user_role on user_role.user_role_id = manager.user_role_id
group by 1, 2, 3, 4
having number_of_direct_reports > 0
  );
    
2020-05-05 23:24:10.054928 (Thread-4): Writing runtime SQL for node "model.salesforce.salesforce_owner_performance"
2020-05-05 23:24:10.055519 (Thread-4): On model.salesforce.salesforce_owner_performance: /* {"app": "dbt", "dbt_version": "0.16.0", "profile_name": "fivetran", "target_name": "dev", "node_id": "model.salesforce.salesforce_owner_performance"} */


  create or replace table `digital-arbor-400`.`dbt_kristin_test`.`salesforce_owner_performance`
  
  
  OPTIONS()
  as (
    with  __dbt__CTE__stg_salesforce_user as (
with base as (

    select *
    from salesforce.user

), fields as (

    select 
      id as user_id,
      name,
      city,
      state,
      manager_id,
      user_role_id
    from base

)

select *
from fields
),  __dbt__CTE__opportunity_aggregation_by_owner as (
with salesforce_opportunity_enhanced as (
    
    select *
    from `digital-arbor-400`.`dbt_kristin_test`.`salesforce_opportunity_enhanced`
  
), user as (

    select *
    from __dbt__CTE__stg_salesforce_user
  
), booking_by_owner as (

  select 
    opportunity_manager_id as b_manager_id,
    opportunity_owner_id as b_owner_id,
    round(sum(closed_amount_this_month)) as bookings_amount_closed_this_month,
    round(sum(closed_amount_this_quarter)) as bookings_amount_closed_this_quarter,
    count(*) as total_number_bookings,
    round(sum(amount)) as total_bookings_amount,
    sum(closed_count_this_month) as bookings_count_closed_this_month,
    sum(closed_count_this_quarter) as bookings_count_closed_this_quarter,
    round(avg(amount)) as avg_bookings_amount,
    max(amount) as largest_booking,
    avg(days_to_close) as avg_days_to_close
  from salesforce_opportunity_enhanced
  where status = 'Won'
  group by 1, 2

), lost_by_owner as (

  select 
    opportunity_manager_id as l_manager_id,
    opportunity_owner_id as l_owner_id,
    round(sum(closed_amount_this_month)) as lost_amount_this_month,
    round(sum(closed_amount_this_quarter)) as lost_amount_this_quarter,
    count(*) as total_number_lost,
    round(sum(amount)) as total_lost_amount,
    sum(closed_count_this_month) as lost_count_this_month,
    sum(closed_count_this_quarter) as lost_count_this_quarter
  from salesforce_opportunity_enhanced
  where status = 'Lost'
  group by 1, 2

), pipeline_by_owner as (

  select 
    opportunity_manager_id as p_manager_id,
    opportunity_owner_id as p_owner_id,
    round(sum(created_amount_this_month)) as pipeline_created_amount_this_month,
    round(sum(created_amount_this_quarter)) as pipeline_created_amount_this_quarter,
    round(sum(created_amount_this_month * probability)) as pipeline_created_forecast_amount_this_month,
    round(sum(created_amount_this_quarter * probability)) as pipeline_created_forecast_amount_this_quarter,
    sum(created_count_this_month) as pipeline_count_created_this_month,
    sum(created_count_this_quarter) as pipeline_count_created_this_quarter,
    count(*) as total_number_pipeline,
    round(sum(amount)) as total_pipeline_amount,
    round(sum(amount * probability)) as total_pipeline_forecast_amount,
    round(avg(amount)) as avg_pipeline_opp_amount,
    max(amount) as largest_deal_in_pipeline,
    avg(days_since_created) as avg_days_open
  from salesforce_opportunity_enhanced
  where status = 'Pipeline'
  group by 1, 2
)

select 
  user.user_id as owner_id,
  coalesce(p_manager_id, b_manager_id, l_manager_id) as manager_id,
  booking_by_owner.*,
  lost_by_owner.*,
  pipeline_by_owner.*
from user 
left join booking_by_owner on booking_by_owner.b_owner_id = user.user_id
left join lost_by_owner on lost_by_owner.l_owner_id = user.user_id
left join pipeline_by_owner on pipeline_by_owner.p_owner_id = user.user_id
),opportunity_aggregation_by_owner as (
    
    select *
    from __dbt__CTE__opportunity_aggregation_by_owner
  
), user as (

    select *
    from __dbt__CTE__stg_salesforce_user
  
)

select 
  opportunity_aggregation_by_owner.*,
	user.name as owner_name,
  user.city as owner_city,
  user.state as owner_state,
  case when (bookings_amount_closed_this_month + lost_amount_this_month) > 0 then
        bookings_amount_closed_this_month / 
          (bookings_amount_closed_this_month + lost_amount_this_month) * 100
          else 0 end as win_percent_this_month,
  case when (bookings_amount_closed_this_quarter + lost_amount_this_quarter) > 0 then
        bookings_amount_closed_this_quarter / 
          (bookings_amount_closed_this_quarter + lost_amount_this_quarter) * 100
          else 0 end as win_percent_this_quarter,
  case when (total_bookings_amount + total_lost_amount) > 0 then 
        total_bookings_amount / (total_bookings_amount + total_lost_amount) * 100
        else 0 end as total_win_percent

from opportunity_aggregation_by_owner
join user on user.user_id = opportunity_aggregation_by_owner.owner_id
  );
    
2020-05-05 23:24:11.490398 (Thread-1): finished collecting timing info
2020-05-05 23:24:11.491294 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '42c0888d-85be-4808-b2a9-56a78545f70d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10688e3d0>]}
2020-05-05 23:24:11.491606 (Thread-1): 16:24:11 | 2 of 4 OK created table model dbt_kristin_test.salesforce_sales_snapshot [CREATE TABLE (1) in 2.04s]
2020-05-05 23:24:11.491781 (Thread-1): Finished running node model.salesforce.salesforce_sales_snapshot
2020-05-05 23:24:12.288404 (Thread-4): finished collecting timing info
2020-05-05 23:24:12.289397 (Thread-4): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '42c0888d-85be-4808-b2a9-56a78545f70d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106063fd0>]}
2020-05-05 23:24:12.289673 (Thread-4): 16:24:12 | 4 of 4 OK created table model dbt_kristin_test.salesforce_owner_performance [CREATE TABLE (285) in 2.74s]
2020-05-05 23:24:12.289896 (Thread-4): Finished running node model.salesforce.salesforce_owner_performance
2020-05-05 23:24:12.425213 (Thread-2): finished collecting timing info
2020-05-05 23:24:12.426114 (Thread-2): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '42c0888d-85be-4808-b2a9-56a78545f70d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106901b90>]}
2020-05-05 23:24:12.426422 (Thread-2): 16:24:12 | 3 of 4 OK created table model dbt_kristin_test.salesforce_manager_performance [CREATE TABLE (31) in 2.93s]
2020-05-05 23:24:12.426601 (Thread-2): Finished running node model.salesforce.salesforce_manager_performance
2020-05-05 23:24:12.481769 (MainThread): 16:24:12 | 
2020-05-05 23:24:12.482192 (MainThread): 16:24:12 | Finished running 4 table models in 8.77s.
2020-05-05 23:24:12.482513 (MainThread): Connection 'master' was left open.
2020-05-05 23:24:12.482670 (MainThread): Connection 'model.salesforce.salesforce_sales_snapshot' was left open.
2020-05-05 23:24:12.482780 (MainThread): Connection 'model.salesforce.salesforce_manager_performance' was left open.
2020-05-05 23:24:12.482880 (MainThread): Connection 'model.salesforce.opportunity_aggregation_by_owner' was properly closed.
2020-05-05 23:24:12.482979 (MainThread): Connection 'model.salesforce.salesforce_owner_performance' was left open.
2020-05-05 23:24:12.496551 (MainThread): 
2020-05-05 23:24:12.496741 (MainThread): Completed successfully
2020-05-05 23:24:12.496882 (MainThread): 
Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
2020-05-05 23:24:12.497078 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105ddd0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1063caed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1060e5890>]}
2020-05-05 23:24:12.497284 (MainThread): Flushing usage events
2020-05-05 23:24:18.056555 (MainThread): Running with dbt=0.16.0
2020-05-05 23:24:18.196598 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.generate.GenerateTask'>, compile=True, debug=False, exclude=None, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/Users/kristin/.dbt', project_dir=None, record_timing_info=None, rpc_method='docs.generate', single_threaded=False, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, vars='{}', version_check=True, warn_error=False, which='generate', write_json=True)
2020-05-05 23:24:18.197832 (MainThread): Tracking: tracking
2020-05-05 23:24:18.203014 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105e31390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1057db450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105e31f10>]}
2020-05-05 23:24:18.220732 (MainThread): Partial parsing not enabled
2020-05-05 23:24:18.222434 (MainThread): Parsing macros/core.sql
2020-05-05 23:24:18.226385 (MainThread): Parsing macros/materializations/helpers.sql
2020-05-05 23:24:18.234819 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2020-05-05 23:24:18.237298 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2020-05-05 23:24:18.253370 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2020-05-05 23:24:18.283686 (MainThread): Parsing macros/materializations/seed/seed.sql
2020-05-05 23:24:18.303035 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2020-05-05 23:24:18.304794 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2020-05-05 23:24:18.310621 (MainThread): Parsing macros/materializations/common/merge.sql
2020-05-05 23:24:18.322336 (MainThread): Parsing macros/materializations/table/table.sql
2020-05-05 23:24:18.328617 (MainThread): Parsing macros/materializations/view/view.sql
2020-05-05 23:24:18.334428 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2020-05-05 23:24:18.339026 (MainThread): Parsing macros/etc/get_custom_alias.sql
2020-05-05 23:24:18.339920 (MainThread): Parsing macros/etc/query.sql
2020-05-05 23:24:18.340932 (MainThread): Parsing macros/etc/is_incremental.sql
2020-05-05 23:24:18.342499 (MainThread): Parsing macros/etc/get_relation_comment.sql
2020-05-05 23:24:18.344441 (MainThread): Parsing macros/etc/datetime.sql
2020-05-05 23:24:18.353116 (MainThread): Parsing macros/etc/get_custom_schema.sql
2020-05-05 23:24:18.354985 (MainThread): Parsing macros/etc/get_custom_database.sql
2020-05-05 23:24:18.355980 (MainThread): Parsing macros/adapters/common.sql
2020-05-05 23:24:18.393246 (MainThread): Parsing macros/schema_tests/relationships.sql
2020-05-05 23:24:18.394292 (MainThread): Parsing macros/schema_tests/not_null.sql
2020-05-05 23:24:18.395130 (MainThread): Parsing macros/schema_tests/unique.sql
2020-05-05 23:24:18.396801 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2020-05-05 23:24:18.399592 (MainThread): Parsing macros/etc.sql
2020-05-05 23:24:18.400198 (MainThread): Parsing macros/catalog.sql
2020-05-05 23:24:18.406959 (MainThread): Parsing macros/adapters.sql
2020-05-05 23:24:18.425743 (MainThread): Parsing macros/materializations/seed.sql
2020-05-05 23:24:18.427541 (MainThread): Parsing macros/materializations/view.sql
2020-05-05 23:24:18.428866 (MainThread): Parsing macros/materializations/table.sql
2020-05-05 23:24:18.437912 (MainThread): Parsing macros/materializations/incremental.sql
2020-05-05 23:24:18.449431 (MainThread): Parsing macros/materializations/snapshot.sql
2020-05-05 23:24:18.473993 (MainThread): Partial parsing not enabled
2020-05-05 23:24:18.475414 (MainThread): Parsing macros/cross_db_utils/except.sql
2020-05-05 23:24:18.476358 (MainThread): Parsing macros/cross_db_utils/replace.sql
2020-05-05 23:24:18.477490 (MainThread): Parsing macros/cross_db_utils/concat.sql
2020-05-05 23:24:18.479549 (MainThread): Parsing macros/cross_db_utils/identifer.sql
2020-05-05 23:24:18.480679 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2020-05-05 23:24:18.485788 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2020-05-05 23:24:18.487015 (MainThread): Parsing macros/cross_db_utils/length.sql
2020-05-05 23:24:18.488229 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2020-05-05 23:24:18.490437 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2020-05-05 23:24:18.491377 (MainThread): Parsing macros/cross_db_utils/right.sql
2020-05-05 23:24:18.493466 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2020-05-05 23:24:18.502179 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2020-05-05 23:24:18.504123 (MainThread): Parsing macros/cross_db_utils/hash.sql
2020-05-05 23:24:18.505423 (MainThread): Parsing macros/cross_db_utils/position.sql
2020-05-05 23:24:18.506852 (MainThread): Parsing macros/cross_db_utils/literal.sql
2020-05-05 23:24:18.507699 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2020-05-05 23:24:18.510467 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2020-05-05 23:24:18.515437 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2020-05-05 23:24:18.517945 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2020-05-05 23:24:18.519614 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2020-05-05 23:24:18.520983 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2020-05-05 23:24:18.541857 (MainThread): Parsing macros/logger/pretty_log_format.sql
2020-05-05 23:24:18.542485 (MainThread): Parsing macros/logger/pretty_time.sql
2020-05-05 23:24:18.543181 (MainThread): Parsing macros/logger/log_info.sql
2020-05-05 23:24:18.543823 (MainThread): Parsing macros/datetime/date_spine.sql
2020-05-05 23:24:18.546900 (MainThread): Parsing macros/web/get_url_host.sql
2020-05-05 23:24:18.548150 (MainThread): Parsing macros/web/get_url_path.sql
2020-05-05 23:24:18.550113 (MainThread): Parsing macros/web/get_url_parameter.sql
2020-05-05 23:24:18.551200 (MainThread): Parsing macros/geo/haversine_distance.sql
2020-05-05 23:24:18.552040 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2020-05-05 23:24:18.553295 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2020-05-05 23:24:18.555128 (MainThread): Parsing macros/schema_tests/recency.sql
2020-05-05 23:24:18.556297 (MainThread): Parsing macros/schema_tests/not_constant.sql
2020-05-05 23:24:18.557203 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2020-05-05 23:24:18.558101 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2020-05-05 23:24:18.559164 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2020-05-05 23:24:18.560496 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2020-05-05 23:24:18.561490 (MainThread): Parsing macros/schema_tests/equality.sql
2020-05-05 23:24:18.564297 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2020-05-05 23:24:18.569351 (MainThread): Parsing macros/sql/nullcheck_table.sql
2020-05-05 23:24:18.570279 (MainThread): Parsing macros/sql/generate_series.sql
2020-05-05 23:24:18.573247 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2020-05-05 23:24:18.576517 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2020-05-05 23:24:18.578908 (MainThread): Parsing macros/sql/star.sql
2020-05-05 23:24:18.581343 (MainThread): Parsing macros/sql/unpivot.sql
2020-05-05 23:24:18.586599 (MainThread): Parsing macros/sql/union.sql
2020-05-05 23:24:18.594954 (MainThread): Parsing macros/sql/groupby.sql
2020-05-05 23:24:18.595801 (MainThread): Parsing macros/sql/surrogate_key.sql
2020-05-05 23:24:18.598294 (MainThread): Parsing macros/sql/safe_add.sql
2020-05-05 23:24:18.599236 (MainThread): Parsing macros/sql/nullcheck.sql
2020-05-05 23:24:18.600348 (MainThread): Parsing macros/sql/get_column_values.sql
2020-05-05 23:24:18.604207 (MainThread): Parsing macros/sql/pivot.sql
2020-05-05 23:24:18.606525 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2020-05-05 23:24:18.639963 (MainThread): Acquiring new bigquery connection "model.salesforce.salesforce_sales_snapshot".
2020-05-05 23:24:18.640050 (MainThread): Opening a new connection, currently in state init
2020-05-05 23:24:18.653743 (MainThread): Acquiring new bigquery connection "model.salesforce.salesforce_owner_performance".
2020-05-05 23:24:18.653820 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:24:18.659793 (MainThread): Acquiring new bigquery connection "model.salesforce.salesforce_manager_performance".
2020-05-05 23:24:18.659870 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:24:18.667189 (MainThread): Acquiring new bigquery connection "model.salesforce.salesforce_opportunity_enhanced".
2020-05-05 23:24:18.667269 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:24:18.673859 (MainThread): Acquiring new bigquery connection "model.salesforce.opportunity_aggregation_by_owner".
2020-05-05 23:24:18.673937 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:24:18.679604 (MainThread): Acquiring new bigquery connection "model.salesforce.stg_salesforce_opportunity".
2020-05-05 23:24:18.679680 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:24:18.784283 (MainThread): Acquiring new bigquery connection "model.salesforce.stg_salesforce_user".
2020-05-05 23:24:18.784444 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:24:18.791318 (MainThread): Acquiring new bigquery connection "model.salesforce.stg_salesforce_user_role".
2020-05-05 23:24:18.791437 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:24:18.797998 (MainThread): Acquiring new bigquery connection "model.salesforce.stg_salesforce_account".
2020-05-05 23:24:18.798115 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:24:18.843308 (MainThread): Acquiring new bigquery connection "test.salesforce.not_null_stg_salesforce_account_account_id".
2020-05-05 23:24:18.843388 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:24:18.850877 (MainThread): Acquiring new bigquery connection "test.salesforce.unique_stg_salesforce_account_account_id".
2020-05-05 23:24:18.850953 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:24:18.858937 (MainThread): Acquiring new bigquery connection "test.salesforce.not_null_stg_salesforce_opportunity_opportunity_id".
2020-05-05 23:24:18.859012 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:24:18.865109 (MainThread): Acquiring new bigquery connection "test.salesforce.unique_stg_salesforce_opportunity_opportunity_id".
2020-05-05 23:24:18.865185 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:24:18.871321 (MainThread): Acquiring new bigquery connection "test.salesforce.not_null_stg_salesforce_user_user_id".
2020-05-05 23:24:18.871397 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:24:18.877443 (MainThread): Acquiring new bigquery connection "test.salesforce.unique_stg_salesforce_user_user_id".
2020-05-05 23:24:18.877519 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:24:18.883562 (MainThread): Acquiring new bigquery connection "test.salesforce.not_null_stg_salesforce_user_role_user_role_id".
2020-05-05 23:24:18.883637 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:24:18.889701 (MainThread): Acquiring new bigquery connection "test.salesforce.unique_stg_salesforce_user_role_user_role_id".
2020-05-05 23:24:18.889777 (MainThread): Opening a new connection, currently in state closed
2020-05-05 23:24:19.170795 (MainThread): Found 9 models, 8 tests, 0 snapshots, 0 analyses, 268 macros, 0 operations, 0 seed files, 0 sources
2020-05-05 23:24:19.178054 (MainThread): 
2020-05-05 23:24:19.178426 (MainThread): 16:24:19 | Concurrency: 4 threads (target='dev')
2020-05-05 23:24:19.178684 (MainThread): 16:24:19 | 
2020-05-05 23:24:19.181325 (Thread-1): Began running node model.salesforce.stg_salesforce_account
2020-05-05 23:24:19.181581 (Thread-2): Began running node model.salesforce.stg_salesforce_opportunity
2020-05-05 23:24:19.181734 (Thread-3): Began running node model.salesforce.stg_salesforce_user
2020-05-05 23:24:19.182256 (Thread-1): Acquiring new bigquery connection "model.salesforce.stg_salesforce_account".
2020-05-05 23:24:19.182413 (Thread-4): Began running node model.salesforce.stg_salesforce_user_role
2020-05-05 23:24:19.182986 (Thread-2): Acquiring new bigquery connection "model.salesforce.stg_salesforce_opportunity".
2020-05-05 23:24:19.183700 (Thread-3): Acquiring new bigquery connection "model.salesforce.stg_salesforce_user".
2020-05-05 23:24:19.183986 (Thread-1): Opening a new connection, currently in state init
2020-05-05 23:24:19.184594 (Thread-4): Acquiring new bigquery connection "model.salesforce.stg_salesforce_user_role".
2020-05-05 23:24:19.184769 (Thread-2): Opening a new connection, currently in state init
2020-05-05 23:24:19.184947 (Thread-3): Opening a new connection, currently in state init
2020-05-05 23:24:19.185140 (Thread-1): Compiling model.salesforce.stg_salesforce_account
2020-05-05 23:24:19.185261 (Thread-4): Opening a new connection, currently in state init
2020-05-05 23:24:19.185428 (Thread-2): Compiling model.salesforce.stg_salesforce_opportunity
2020-05-05 23:24:19.185616 (Thread-3): Compiling model.salesforce.stg_salesforce_user
2020-05-05 23:24:19.202568 (Thread-4): Compiling model.salesforce.stg_salesforce_user_role
2020-05-05 23:24:19.204242 (Thread-1): Writing injected SQL for node "model.salesforce.stg_salesforce_account"
2020-05-05 23:24:19.225643 (Thread-2): Writing injected SQL for node "model.salesforce.stg_salesforce_opportunity"
2020-05-05 23:24:19.228051 (Thread-3): Writing injected SQL for node "model.salesforce.stg_salesforce_user"
2020-05-05 23:24:19.234769 (Thread-4): Writing injected SQL for node "model.salesforce.stg_salesforce_user_role"
2020-05-05 23:24:19.235517 (Thread-1): finished collecting timing info
2020-05-05 23:24:19.235974 (Thread-1): Finished running node model.salesforce.stg_salesforce_account
2020-05-05 23:24:19.236338 (Thread-2): finished collecting timing info
2020-05-05 23:24:19.236605 (Thread-1): Began running node test.salesforce.not_null_stg_salesforce_account_account_id
2020-05-05 23:24:19.236971 (Thread-2): Finished running node model.salesforce.stg_salesforce_opportunity
2020-05-05 23:24:19.237348 (Thread-1): Acquiring new bigquery connection "test.salesforce.not_null_stg_salesforce_account_account_id".
2020-05-05 23:24:19.237525 (Thread-2): Began running node test.salesforce.unique_stg_salesforce_account_account_id
2020-05-05 23:24:19.237628 (Thread-3): finished collecting timing info
2020-05-05 23:24:19.237829 (Thread-4): finished collecting timing info
2020-05-05 23:24:19.238118 (Thread-1): Opening a new connection, currently in state closed
2020-05-05 23:24:19.238480 (Thread-2): Acquiring new bigquery connection "test.salesforce.unique_stg_salesforce_account_account_id".
2020-05-05 23:24:19.238745 (Thread-3): Finished running node model.salesforce.stg_salesforce_user
2020-05-05 23:24:19.239009 (Thread-4): Finished running node model.salesforce.stg_salesforce_user_role
2020-05-05 23:24:19.239134 (Thread-1): Compiling test.salesforce.not_null_stg_salesforce_account_account_id
2020-05-05 23:24:19.239228 (Thread-2): Opening a new connection, currently in state closed
2020-05-05 23:24:19.239347 (Thread-3): Began running node test.salesforce.not_null_stg_salesforce_opportunity_opportunity_id
2020-05-05 23:24:19.239477 (Thread-4): Began running node test.salesforce.unique_stg_salesforce_opportunity_opportunity_id
2020-05-05 23:24:19.252468 (Thread-2): Compiling test.salesforce.unique_stg_salesforce_account_account_id
2020-05-05 23:24:19.256088 (Thread-1): Writing injected SQL for node "test.salesforce.not_null_stg_salesforce_account_account_id"
2020-05-05 23:24:19.256409 (Thread-3): Acquiring new bigquery connection "test.salesforce.not_null_stg_salesforce_opportunity_opportunity_id".
2020-05-05 23:24:19.256659 (Thread-4): Acquiring new bigquery connection "test.salesforce.unique_stg_salesforce_opportunity_opportunity_id".
2020-05-05 23:24:19.267210 (Thread-2): Writing injected SQL for node "test.salesforce.unique_stg_salesforce_account_account_id"
2020-05-05 23:24:19.267449 (Thread-3): Opening a new connection, currently in state closed
2020-05-05 23:24:19.267642 (Thread-4): Opening a new connection, currently in state closed
2020-05-05 23:24:19.267783 (Thread-1): finished collecting timing info
2020-05-05 23:24:19.268095 (Thread-3): Compiling test.salesforce.not_null_stg_salesforce_opportunity_opportunity_id
2020-05-05 23:24:19.268265 (Thread-4): Compiling test.salesforce.unique_stg_salesforce_opportunity_opportunity_id
2020-05-05 23:24:19.268471 (Thread-1): finished collecting timing info
2020-05-05 23:24:19.268657 (Thread-2): finished collecting timing info
2020-05-05 23:24:19.283341 (Thread-3): Writing injected SQL for node "test.salesforce.not_null_stg_salesforce_opportunity_opportunity_id"
2020-05-05 23:24:19.283584 (Thread-1): Finished running node test.salesforce.not_null_stg_salesforce_account_account_id
2020-05-05 23:24:19.286851 (Thread-4): Writing injected SQL for node "test.salesforce.unique_stg_salesforce_opportunity_opportunity_id"
2020-05-05 23:24:19.286965 (Thread-2): finished collecting timing info
2020-05-05 23:24:19.287257 (Thread-1): Began running node model.salesforce.salesforce_opportunity_enhanced
2020-05-05 23:24:19.287597 (Thread-2): Finished running node test.salesforce.unique_stg_salesforce_account_account_id
2020-05-05 23:24:19.287924 (Thread-1): Acquiring new bigquery connection "model.salesforce.salesforce_opportunity_enhanced".
2020-05-05 23:24:19.288088 (Thread-4): finished collecting timing info
2020-05-05 23:24:19.288248 (Thread-3): finished collecting timing info
2020-05-05 23:24:19.288412 (Thread-2): Began running node test.salesforce.not_null_stg_salesforce_user_role_user_role_id
2020-05-05 23:24:19.288551 (Thread-1): Opening a new connection, currently in state closed
2020-05-05 23:24:19.288663 (Thread-4): finished collecting timing info
2020-05-05 23:24:19.288864 (Thread-3): finished collecting timing info
2020-05-05 23:24:19.289148 (Thread-2): Acquiring new bigquery connection "test.salesforce.not_null_stg_salesforce_user_role_user_role_id".
2020-05-05 23:24:19.289244 (Thread-1): Compiling model.salesforce.salesforce_opportunity_enhanced
2020-05-05 23:24:19.289448 (Thread-4): Finished running node test.salesforce.unique_stg_salesforce_opportunity_opportunity_id
2020-05-05 23:24:19.289661 (Thread-3): Finished running node test.salesforce.not_null_stg_salesforce_opportunity_opportunity_id
2020-05-05 23:24:19.289751 (Thread-2): Opening a new connection, currently in state closed
2020-05-05 23:24:19.296172 (Thread-4): Began running node test.salesforce.not_null_stg_salesforce_user_user_id
2020-05-05 23:24:19.314581 (Thread-1): Writing injected SQL for node "model.salesforce.salesforce_opportunity_enhanced"
2020-05-05 23:24:19.314676 (Thread-3): Began running node test.salesforce.unique_stg_salesforce_user_role_user_role_id
2020-05-05 23:24:19.314784 (Thread-2): Compiling test.salesforce.not_null_stg_salesforce_user_role_user_role_id
2020-05-05 23:24:19.315048 (Thread-4): Acquiring new bigquery connection "test.salesforce.not_null_stg_salesforce_user_user_id".
2020-05-05 23:24:19.315347 (Thread-3): Acquiring new bigquery connection "test.salesforce.unique_stg_salesforce_user_role_user_role_id".
2020-05-05 23:24:19.321235 (Thread-1): finished collecting timing info
2020-05-05 23:24:19.321421 (Thread-4): Opening a new connection, currently in state closed
2020-05-05 23:24:19.323273 (Thread-2): Writing injected SQL for node "test.salesforce.not_null_stg_salesforce_user_role_user_role_id"
2020-05-05 23:24:19.323364 (Thread-3): Opening a new connection, currently in state closed
2020-05-05 23:24:19.323467 (Thread-1): finished collecting timing info
2020-05-05 23:24:19.323650 (Thread-4): Compiling test.salesforce.not_null_stg_salesforce_user_user_id
2020-05-05 23:24:19.323829 (Thread-3): Compiling test.salesforce.unique_stg_salesforce_user_role_user_role_id
2020-05-05 23:24:19.323986 (Thread-2): finished collecting timing info
2020-05-05 23:24:19.324279 (Thread-1): Finished running node model.salesforce.salesforce_opportunity_enhanced
2020-05-05 23:24:19.338149 (Thread-4): Writing injected SQL for node "test.salesforce.not_null_stg_salesforce_user_user_id"
2020-05-05 23:24:19.338263 (Thread-2): finished collecting timing info
2020-05-05 23:24:19.340707 (Thread-3): Writing injected SQL for node "test.salesforce.unique_stg_salesforce_user_role_user_role_id"
2020-05-05 23:24:19.340825 (Thread-1): Began running node test.salesforce.unique_stg_salesforce_user_user_id
2020-05-05 23:24:19.341193 (Thread-2): Finished running node test.salesforce.not_null_stg_salesforce_user_role_user_role_id
2020-05-05 23:24:19.341478 (Thread-4): finished collecting timing info
2020-05-05 23:24:19.341843 (Thread-1): Acquiring new bigquery connection "test.salesforce.unique_stg_salesforce_user_user_id".
2020-05-05 23:24:19.342037 (Thread-2): Began running node model.salesforce.opportunity_aggregation_by_owner
2020-05-05 23:24:19.342117 (Thread-3): finished collecting timing info
2020-05-05 23:24:19.342314 (Thread-4): finished collecting timing info
2020-05-05 23:24:19.342530 (Thread-1): Opening a new connection, currently in state closed
2020-05-05 23:24:19.342742 (Thread-2): Acquiring new bigquery connection "model.salesforce.opportunity_aggregation_by_owner".
2020-05-05 23:24:19.342853 (Thread-3): finished collecting timing info
2020-05-05 23:24:19.343159 (Thread-4): Finished running node test.salesforce.not_null_stg_salesforce_user_user_id
2020-05-05 23:24:19.343259 (Thread-1): Compiling test.salesforce.unique_stg_salesforce_user_user_id
2020-05-05 23:24:19.343336 (Thread-2): Opening a new connection, currently in state closed
2020-05-05 23:24:19.343535 (Thread-3): Finished running node test.salesforce.unique_stg_salesforce_user_role_user_role_id
2020-05-05 23:24:19.343649 (Thread-4): Began running node model.salesforce.salesforce_sales_snapshot
2020-05-05 23:24:19.352597 (Thread-1): Writing injected SQL for node "test.salesforce.unique_stg_salesforce_user_user_id"
2020-05-05 23:24:19.352705 (Thread-2): Compiling model.salesforce.opportunity_aggregation_by_owner
2020-05-05 23:24:19.353138 (Thread-4): Acquiring new bigquery connection "model.salesforce.salesforce_sales_snapshot".
2020-05-05 23:24:19.378304 (Thread-4): Opening a new connection, currently in state closed
2020-05-05 23:24:19.378423 (Thread-4): Compiling model.salesforce.salesforce_sales_snapshot
2020-05-05 23:24:19.415384 (Thread-4): Writing injected SQL for node "model.salesforce.salesforce_sales_snapshot"
2020-05-05 23:24:19.426391 (Thread-2): Writing injected SQL for node "model.salesforce.opportunity_aggregation_by_owner"
2020-05-05 23:24:19.426507 (Thread-1): finished collecting timing info
2020-05-05 23:24:19.427038 (Thread-1): finished collecting timing info
2020-05-05 23:24:19.427516 (Thread-1): Finished running node test.salesforce.unique_stg_salesforce_user_user_id
2020-05-05 23:24:19.427950 (Thread-4): finished collecting timing info
2020-05-05 23:24:19.428240 (Thread-4): finished collecting timing info
2020-05-05 23:24:19.428664 (Thread-4): Finished running node model.salesforce.salesforce_sales_snapshot
2020-05-05 23:24:19.428893 (Thread-2): finished collecting timing info
2020-05-05 23:24:19.429346 (Thread-2): Finished running node model.salesforce.opportunity_aggregation_by_owner
2020-05-05 23:24:19.429680 (Thread-3): Began running node model.salesforce.salesforce_manager_performance
2020-05-05 23:24:19.429977 (Thread-3): Acquiring new bigquery connection "model.salesforce.salesforce_manager_performance".
2020-05-05 23:24:19.430095 (Thread-3): Opening a new connection, currently in state closed
2020-05-05 23:24:19.430208 (Thread-3): Compiling model.salesforce.salesforce_manager_performance
2020-05-05 23:24:19.436792 (Thread-1): Began running node model.salesforce.salesforce_owner_performance
2020-05-05 23:24:19.437105 (Thread-1): Acquiring new bigquery connection "model.salesforce.salesforce_owner_performance".
2020-05-05 23:24:19.437220 (Thread-1): Opening a new connection, currently in state closed
2020-05-05 23:24:19.449168 (Thread-1): Compiling model.salesforce.salesforce_owner_performance
2020-05-05 23:24:19.478334 (Thread-1): Writing injected SQL for node "model.salesforce.salesforce_owner_performance"
2020-05-05 23:24:19.493136 (Thread-3): Writing injected SQL for node "model.salesforce.salesforce_manager_performance"
2020-05-05 23:24:19.493428 (Thread-1): finished collecting timing info
2020-05-05 23:24:19.493637 (Thread-1): finished collecting timing info
2020-05-05 23:24:19.493961 (Thread-1): Finished running node model.salesforce.salesforce_owner_performance
2020-05-05 23:24:19.494251 (Thread-3): finished collecting timing info
2020-05-05 23:24:19.494442 (Thread-3): finished collecting timing info
2020-05-05 23:24:19.494778 (Thread-3): Finished running node model.salesforce.salesforce_manager_performance
2020-05-05 23:24:19.517231 (MainThread): Connection 'test.salesforce.unique_stg_salesforce_user_role_user_role_id' was properly closed.
2020-05-05 23:24:19.517596 (MainThread): Connection 'model.salesforce.salesforce_owner_performance' was properly closed.
2020-05-05 23:24:19.517863 (MainThread): Connection 'model.salesforce.opportunity_aggregation_by_owner' was properly closed.
2020-05-05 23:24:19.518000 (MainThread): Connection 'model.salesforce.salesforce_manager_performance' was properly closed.
2020-05-05 23:24:19.518133 (MainThread): Connection 'model.salesforce.salesforce_sales_snapshot' was properly closed.
2020-05-05 23:24:19.549318 (MainThread): 16:24:19 | Done.
2020-05-05 23:24:19.551032 (MainThread): Acquiring new bigquery connection "generate_catalog".
2020-05-05 23:24:19.551148 (MainThread): Opening a new connection, currently in state init
2020-05-05 23:24:19.551220 (MainThread): 16:24:19 | Building catalog
2020-05-05 23:24:20.109645 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "digital-arbor-400.information_schema".
2020-05-05 23:24:20.109935 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2020-05-05 23:24:20.132133 (ThreadPoolExecutor-0_0): On digital-arbor-400.information_schema: /* {"app": "dbt", "dbt_version": "0.16.0", "profile_name": "fivetran", "target_name": "dev", "connection_name": "digital-arbor-400.information_schema"} */

    with schemas as (

        select
          catalog_name as table_database,
          schema_name as table_schema,
          location

        from `digital-arbor-400`.INFORMATION_SCHEMA.SCHEMATA
        where (upper(schema_name) = upper('dbt_kristin_test'))
    ),

    tables as (
        select
            project_id as table_database,
            dataset_id as table_schema,
            table_id as original_table_name,

            concat(project_id, '.', dataset_id, '.', table_id) as relation_id,

            row_count,
            size_bytes as size_bytes,
            case
                when type = 1 then 'table'
                when type = 2 then 'view'
                else 'external'
            end as table_type,

            REGEXP_CONTAINS(table_id, '^.+[0-9]{8}$') and coalesce(type, 0) = 1 as is_date_shard,
            REGEXP_EXTRACT(table_id, '^(.+)[0-9]{8}$') as shard_base_name,
            REGEXP_EXTRACT(table_id, '^.+([0-9]{8})$') as shard_name

        from `digital-arbor-400`.`dbt_kristin_test`.__TABLES__

    ),

    extracted as (

        select *,
            case
                when is_date_shard then shard_base_name
                else original_table_name
            end as table_name

        from tables

    ),

    unsharded_tables as (

        select
            table_database,
            table_schema,
            table_name,
            coalesce(table_type, 'external') as table_type,
            is_date_shard,

            struct(
                min(shard_name) as shard_min,
                max(shard_name) as shard_max,
                count(*) as shard_count
            ) as table_shards,

            sum(size_bytes) as size_bytes,
            sum(row_count) as row_count,

            max(relation_id) as relation_id

        from extracted
        group by 1,2,3,4,5

    ),

    info_schema_columns as (

        select
            concat(table_catalog, '.', table_schema, '.', table_name) as relation_id,
            table_catalog as table_database,
            table_schema,
            table_name,

            -- use the "real" column name from the paths query below
            column_name as base_column_name,
            ordinal_position as column_index,
            cast(null as string) as column_comment,

            is_partitioning_column,
            clustering_ordinal_position

        from `digital-arbor-400`.`dbt_kristin_test`.INFORMATION_SCHEMA.COLUMNS
        where ordinal_position is not null

    ),

    info_schema_column_paths as (

        select
            concat(table_catalog, '.', table_schema, '.', table_name) as relation_id,
            field_path as column_name,
            data_type as column_type,
            column_name as base_column_name

        from `digital-arbor-400`.`dbt_kristin_test`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS
        where data_type not like 'STRUCT%'

    ),

    columns as (

        select * except (base_column_name)
        from info_schema_columns
        join info_schema_column_paths using (relation_id, base_column_name)

    ),

    column_stats as (

        select
            table_database,
            table_schema,
            table_name,
            max(relation_id) as relation_id,
            max(case when is_partitioning_column = 'YES' then 1 else 0 end) = 1 as is_partitioned,
            max(case when is_partitioning_column = 'YES' then column_name else null end) as partition_column,
            max(case when clustering_ordinal_position is not null then 1 else 0 end) = 1 as is_clustered,
            array_to_string(
                array_agg(
                    case
                        when clustering_ordinal_position is not null then column_name
                        else null
                    end ignore nulls
                    order by clustering_ordinal_position
                ), ', '
            ) as clustering_columns

        from columns
        group by 1,2,3

    )

    select
        unsharded_tables.table_database,
        unsharded_tables.table_schema,
        case
            when is_date_shard then concat(unsharded_tables.table_name, '*')
            else unsharded_tables.table_name
        end as table_name,
        unsharded_tables.table_type,

        -- coalesce name and type for External tables - these columns are not
        -- present in the COLUMN_FIELD_PATHS resultset
        coalesce(columns.column_name, '<unknown>') as column_name,
        -- invent a row number to account for nested fields -- BQ does
        -- not treat these nested properties as independent fields
        row_number() over (
            partition by relation_id
            order by columns.column_index, columns.column_name
        ) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        columns.column_comment,

        'Location' as `stats__location__label`,
        location as `stats__location__value`,
        'The geographic location of this table' as `stats__location__description`,
        location is not null as `stats__location__include`,

        'Shard count' as `stats__date_shards__label`,
        table_shards.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_shards.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_shards.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        (unsharded_tables.table_type = 'table') as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        (unsharded_tables.table_type = 'table') as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        is_clustered as `stats__clustering_fields__include`

    -- join using relation_id (an actual relation, not a shard prefix) to make
    -- sure that column metadata is picked up through the join. This will only
    -- return the column information for the "max" table in a date-sharded table set
    from unsharded_tables
    left join schemas using(table_database, table_schema)
    left join columns using (relation_id)
    left join column_stats using (relation_id)
  
2020-05-05 23:24:23.142502 (MainThread): 16:24:23 | Catalog written to /Users/kristin/Documents/Github/dbt_salesforce/target/catalog.json
2020-05-05 23:24:23.142897 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106424610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106424410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106434950>]}
2020-05-05 23:24:23.143102 (MainThread): Flushing usage events
2020-05-05 23:24:23.452220 (MainThread): Connection 'generate_catalog' was left open.
2020-05-05 23:24:23.452417 (MainThread): Connection 'digital-arbor-400.information_schema' was left open.
